# EasyAIoT ç³»ç»Ÿå…¨æ¨¡å—åŠŸèƒ½æ¢³ç†ä¸å¼€å‘æ€è·¯ç¡®è®¤

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-24  
**ç›®çš„**: å…¨é¢æ¢³ç†ç³»ç»Ÿå„æ¨¡å—åŠŸèƒ½ï¼Œç¡®è®¤TASKæ¨¡å—å¼€å‘æ€è·¯ï¼Œé¿å…åŠŸèƒ½é‡å¤å’Œé—æ¼

---

## ğŸ“Š ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EasyAIoT äº‘è¾¹ç«¯ä¸€ä½“åŒ–å¹³å°                    â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   WEB    â”‚  â”‚  DEVICE  â”‚  â”‚   AI     â”‚  â”‚  VIDEO   â”‚         â”‚
â”‚  â”‚  å‰ç«¯UI  â”‚  â”‚  åç«¯ç½‘å…³ â”‚  â”‚ æ¨¡å‹è®­ç»ƒ  â”‚  â”‚ è§†é¢‘è½¬å‘  â”‚         â”‚
â”‚  â”‚  :8099   â”‚  â”‚  :48080  â”‚  â”‚  :5000   â”‚  â”‚  :6000   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â†“              â†“             â†“             â†“                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              åŸºç¡€è®¾æ–½å±‚                              â”‚          â”‚
â”‚  â”‚  PostgreSQL | MinIO | ZLMediaKit | Node-RED        â”‚          â”‚
â”‚  â”‚    :5432    | :9000 |   :1935    |  :1880          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              è¾¹ç¼˜è®¡ç®—å±‚ï¼ˆæ­£åœ¨å¼€å‘ï¼‰                   â”‚          â”‚
â”‚  â”‚  TASK(C++) + TaskManager(C++)                      â”‚          â”‚
â”‚  â”‚  å®æ—¶AIæ¨ç†   HTTP APIç®¡ç†å™¨                          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å„æ¨¡å—è¯¦ç»†åŠŸèƒ½æ¢³ç†

### 1ï¸âƒ£ WEB æ¨¡å—ï¼ˆå‰ç«¯ - Vue3ï¼‰

**ç«¯å£**: `8099`  
**æŠ€æœ¯æ ˆ**: Vue3 + TypeScript + Ant Design Vue + Vite  
**é…ç½®æ–‡ä»¶**: `WEB/.env`, `WEB/.env.development`

#### æ ¸å¿ƒé¡µé¢

| é¡µé¢è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|------|
| `/camera` | æ‘„åƒå¤´ç®¡ç† | âœ… å®Œæˆ | è®¾å¤‡åˆ—è¡¨ã€å¯åœè½¬å‘ã€è§†é¢‘æ’­æ”¾ |
| `/dataset` | æ•°æ®é›†ç®¡ç† | âœ… å®Œæˆ | æ•°æ®æ ‡æ³¨ã€å›¾ç‰‡/è§†é¢‘æ•°æ®é›† |
| `/train` | æ¨¡å‹è®­ç»ƒ | âœ… å®Œæˆ | YOLOv8è®­ç»ƒã€å¯¼å‡º |
| `/devices` | IoTè®¾å¤‡ç®¡ç† | âœ… å®Œæˆ | ç‰©è”ç½‘è®¾å¤‡ã€äº§å“ç®¡ç† |
| `/rulechains` | è§„åˆ™å¼•æ“ | âœ… å®Œæˆ | Node-REDè§„åˆ™é…ç½® |
| `/system` | ç³»ç»Ÿç®¡ç† | âœ… å®Œæˆ | ç”¨æˆ·ã€è§’è‰²ã€æƒé™ |
| `/dashboard` | ä»ªè¡¨ç›˜ | âœ… å®Œæˆ | æ•°æ®å¯è§†åŒ– |

#### æ‘„åƒå¤´ç®¡ç†é¡µé¢è¯¦ç»†åŠŸèƒ½

**æ–‡ä»¶**: `WEB/src/views/camera/index.vue`

**è¡¨æ ¼å±•ç¤º**ï¼š
```typescript
- è®¾å¤‡ID
- è®¾å¤‡åç§°
- åœ¨çº¿çŠ¶æ€ï¼ˆç»¿è‰²/çº¢è‰²ï¼‰
- åˆ¶é€ å•†ã€å‹å·ã€MACåœ°å€
- æ‹‰æµåœ°å€ï¼ˆRTSPï¼‰
- æ¨æµåœ°å€ï¼ˆRTMPï¼‰ â† VIDEOæ¨¡å—æ¨é€çš„
- æ’­æ”¾åœ°å€ï¼ˆHTTP-FLVï¼‰ â† å‰ç«¯æ’­æ”¾çš„
- æµçŠ¶æ€ï¼ˆrunning/stopped/errorï¼‰
- æ“ä½œæŒ‰é’®ï¼ˆæ’­æ”¾ã€å¯åœè½¬å‘ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
```

**APIè°ƒç”¨**ï¼š
```typescript
// WEB/src/api/device/camera.ts
startStreamForwarding(device_id)  // å¯åŠ¨VIDEOæ¨¡å—çš„RTSPè½¬å‘
stopStreamForwarding(device_id)   // åœæ­¢VIDEOæ¨¡å—çš„è½¬å‘
getStreamStatus(device_id)        // æŸ¥è¯¢è½¬å‘çŠ¶æ€
getDeviceList()                   // è·å–è®¾å¤‡åˆ—è¡¨
```

**è§†é¢‘æ’­æ”¾å™¨**ï¼š
```typescript
// WEB/src/components/VideoPlayer/DialogPlayer.vue
- Jessibucaæ’­æ”¾å™¨ï¼ˆæ”¯æŒHTTP-FLVï¼‰
- PTZäº‘å°æ§åˆ¶ï¼ˆä¸Šä¸‹å·¦å³ã€å˜ç„¦ï¼‰
- æ’­æ”¾åœ°å€åˆ‡æ¢
```

#### å‰ç«¯ä»£ç†é…ç½®

```javascript
// WEB/.env.development
VITE_PROXY = [
  ["/api/v1/buckets", "http://localhost:9000/api/v1/buckets"],  // MinIO
  ["/dev-api/nodeRed", "http://127.0.0.1:1880"],                // Node-RED
  ["/dev-api", "http://127.0.0.1:48080/admin-api"]              // DEVICEç½‘å…³
]
```

**âš ï¸ ç¼ºå¤±åŠŸèƒ½**ï¼š
- âŒ æ²¡æœ‰AIä»»åŠ¡ç®¡ç†é¡µé¢
- âŒ æ²¡æœ‰è§†é¢‘å¢™é¡µé¢
- âŒ æ²¡æœ‰TaskManageræ¥å£è°ƒç”¨

---

### 2ï¸âƒ£ DEVICE æ¨¡å—ï¼ˆåç«¯ç½‘å…³ - Java Springï¼‰

**ç«¯å£**: `48080`ï¼ˆSpring Cloud Gatewayï¼‰  
**æŠ€æœ¯æ ˆ**: Java 17 + Spring Boot + Spring Cloud Gateway + PostgreSQL  
**æ•°æ®åº“**: `iot_device10`

#### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**ğŸ“± IoTè®¾å¤‡ç®¡ç†**ï¼š
```java
// DEVICE/iot-device/iot-device-biz/src/main/java/com/basiclab/iot/device/controller/device/DeviceController.java

POST /device/report           - è®¾å¤‡ä¸ŠæŠ¥æ•°æ®
POST /device/alarm            - è®¾å¤‡å‘Šè­¦å›è°ƒ â† âš ï¸ TASKæ¨¡å—å‘Šè­¦å¯ä»¥ç”¨è¿™ä¸ªï¼
POST /device/isExist          - åˆ¤æ–­è®¾å¤‡æ˜¯å¦å­˜åœ¨
POST /device/webHook          - EMQXé’©å­å›è°ƒ
GET  /device/list             - è®¾å¤‡åˆ—è¡¨
PUT  /device/update           - æ›´æ–°è®¾å¤‡
DELETE /device/{id}           - åˆ é™¤è®¾å¤‡
```

**âš™ï¸ è§„åˆ™å¼•æ“ï¼ˆNode-REDé›†æˆï¼‰**ï¼š
```
ç«¯å£: 1880
åŠŸèƒ½:
- å‘Šè­¦è§„åˆ™é…ç½®
- æ•°æ®è½¬æ¢
- MQTT/KafkaèŠ‚ç‚¹
- è‡ªå®šä¹‰å‡½æ•°
- å¤–éƒ¨ç³»ç»Ÿé›†æˆï¼ˆä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€é‚®ä»¶ï¼‰
```

**ğŸ·ï¸ æ•°æ®æ ‡æ³¨**ï¼š
```
- æ•°æ®é›†ç®¡ç†
- å›¾ç‰‡/è§†é¢‘æ ‡æ³¨å·¥å…·
- æ ‡ç­¾ç®¡ç†
```

**ğŸ‘¥ ç³»ç»Ÿç®¡ç†**ï¼š
```
- ç§Ÿæˆ·ç®¡ç†
- ç”¨æˆ·ç®¡ç†
- è§’è‰²æƒé™
- èœå•ç®¡ç†
```

#### APIè·¯ç”±é…ç½®

```yaml
# DEVICE/iot-gateway/src/main/resources/application.yaml
spring.cloud.gateway.routes:
  - id: video-admin-api
    uri: lb://video-server
    predicates: Path=/admin-api/video/**
    
  - id: model-admin-api
    uri: lb://model-server
    predicates: Path=/admin-api/model/**
    
  - id: device-admin-api
    uri: lb://device-server
    predicates: Path=/admin-api/device/**
```

**âœ… å¯ä»¥å¤ç”¨çš„åŠŸèƒ½**ï¼š
- âœ… **å‘Šè­¦å›è°ƒæ¥å£**ï¼š`POST /device/alarm` - TASKæ¨¡å—å¯ä»¥ç›´æ¥ç”¨ï¼
- âœ… **è§„åˆ™å¼•æ“**ï¼šNode-REDå¤„ç†å‘Šè­¦é€»è¾‘
- âœ… **ç”¨æˆ·æƒé™**ï¼šå·²æœ‰çš„è®¤è¯é‰´æƒä½“ç³»

**âš ï¸ éœ€è¦æ–°å¢çš„**ï¼š
- âŒ TaskManagerä»£ç†è·¯ç”±ï¼ˆ`/admin-api/task/**` â†’ `http://localhost:7000`ï¼‰

---

### 3ï¸âƒ£ VIDEO æ¨¡å—ï¼ˆè§†é¢‘è½¬å‘ - Python Flaskï¼‰

**ç«¯å£**: `6000`  
**æŠ€æœ¯æ ˆ**: Python 3.8+ + Flask + FFmpeg + ONVIF  
**æ•°æ®åº“**: `iot_video10`

#### æ ¸å¿ƒåŠŸèƒ½

**APIæ¥å£**ï¼š
```python
# VIDEO/app/blueprints/camera.py

POST   /video/camera/device/{device_id}/stream/start   - å¯åŠ¨RTSPâ†’RTMPè½¬å‘
POST   /video/camera/device/{device_id}/stream/stop    - åœæ­¢è½¬å‘
GET    /video/camera/device/{device_id}/stream/status  - æŸ¥è¯¢è½¬å‘çŠ¶æ€
GET    /video/camera/list                              - æ‘„åƒå¤´åˆ—è¡¨
POST   /video/camera/register/device                   - æ³¨å†Œæ‘„åƒå¤´
PUT    /video/camera/device/{device_id}                - æ›´æ–°æ‘„åƒå¤´
DELETE /video/camera/device/{device_id}                - åˆ é™¤æ‘„åƒå¤´
POST   /video/camera/device/{device_id}/ptz            - PTZäº‘å°æ§åˆ¶
GET    /video/camera/discovery                         - ONVIFè®¾å¤‡å‘ç°
POST   /video/camera/refresh                           - åˆ·æ–°è®¾å¤‡åˆ—è¡¨

# æˆªå›¾åŠŸèƒ½
POST   /video/camera/device/{device_id}/rtsp/start     - å¯åŠ¨RTSPæˆªå›¾
POST   /video/camera/device/{device_id}/rtsp/stop      - åœæ­¢RTSPæˆªå›¾
GET    /video/camera/device/{device_id}/rtsp/status    - RTSPæˆªå›¾çŠ¶æ€
POST   /video/camera/device/{device_id}/onvif/start    - å¯åŠ¨ONVIFæˆªå›¾
POST   /video/camera/device/{device_id}/onvif/stop     - åœæ­¢ONVIFæˆªå›¾
GET    /video/camera/device/{device_id}/onvif/status   - ONVIFæˆªå›¾çŠ¶æ€
```

**FFmpegè½¬å‘å®ç°**ï¼š
```python
# VIDEO/app/blueprints/camera.py:37
class FFmpegDaemon:
    """FFmpegå®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†RTSPâ†’RTMPè½¬å‘"""
    
    def start(device_id, rtsp_url, rtmp_url):
        cmd = [
            'ffmpeg',
            '-rtsp_transport', 'tcp',
            '-i', rtsp_url,
            '-c', 'copy',
            '-f', 'flv',
            rtmp_url
        ]
        subprocess.Popen(cmd)
```

**æ•°æ®æ¨¡å‹**ï¼š
```python
# VIDEO/models.py
class Device(db.Model):
    id = db.Column(db.String(100), primary_key=True)
    name = db.Column(db.String(100))
    source = db.Column(db.Text)         # RTSPåœ°å€
    rtmp_stream = db.Column(db.Text)    # RTMPæ¨æµåœ°å€
    http_stream = db.Column(db.Text)    # HTTP-FLVæ’­æ”¾åœ°å€
    ip, port, username, password        # è®¾å¤‡è¿æ¥ä¿¡æ¯
    mac, manufacturer, model            # è®¾å¤‡ä¿¡æ¯
    support_move, support_zoom          # PTZèƒ½åŠ›
    enable_forward = db.Column(db.Boolean)  # æ˜¯å¦å¯ç”¨è½¬å‘
    nvr_id, nvr_channel                 # NVRä¿¡æ¯
```

**âœ… å¯ä»¥å¤ç”¨çš„åŠŸèƒ½**ï¼š
- âœ… **ONVIFè®¾å¤‡å‘ç°**ï¼šå¯ä»¥ç›´æ¥ç”¨äºå‘ç°æ‘„åƒå¤´
- âœ… **PTZäº‘å°æ§åˆ¶**ï¼šå¯ä»¥å¤ç”¨
- âœ… **æˆªå›¾æŠ“å¸§**ï¼šå¯ä»¥ç”¨äºæ•°æ®æ ‡æ³¨
- âœ… **æ•°æ®åº“è¡¨ç»“æ„**ï¼šDeviceè¡¨å¯ä»¥æ‰©å±•

**âŒ ä¸éœ€è¦çš„åŠŸèƒ½**ï¼ˆTASKä¼šæ›¿ä»£ï¼‰ï¼š
- âŒ RTSPâ†’RTMPè½¬å‘ï¼ˆTASKä¼šåšï¼Œä¸”å¸¦AIæ£€æµ‹ï¼‰
- âŒ FFmpegè¿›ç¨‹ç®¡ç†ï¼ˆTASKå†…ç½®ï¼‰

**ğŸ”„ æ”¹é€ æ–¹æ¡ˆ**ï¼š
- ä¿ç•™ONVIFã€PTZã€æˆªå›¾åŠŸèƒ½
- **æ–°å¢å­—æ®µ**ï¼š`ai_task_id`ã€`ai_enabled`ã€`ai_model`
- å‰ç«¯å¯ä»¥é€‰æ‹©ï¼šä½¿ç”¨VIDEOè½¬å‘ï¼ˆæ— AIï¼‰æˆ–å¯åŠ¨TASKï¼ˆæœ‰AIï¼‰

---

### 4ï¸âƒ£ AI æ¨¡å—ï¼ˆæ¨¡å‹è®­ç»ƒ - Python Flaskï¼‰

**ç«¯å£**: `5000`  
**æŠ€æœ¯æ ˆ**: Python 3.8+ + Flask + YOLOv8 + ONNX Runtime  
**æ•°æ®åº“**: `iot_ai10`

#### æ ¸å¿ƒåŠŸèƒ½

**æ¨¡å‹è®­ç»ƒ**ï¼š
```python
# AI/app/blueprints/train.py
POST /train/start              - å¯åŠ¨YOLOv8è®­ç»ƒ
POST /train/stop               - åœæ­¢è®­ç»ƒ
GET  /train/status             - æŸ¥è¯¢è®­ç»ƒçŠ¶æ€
GET  /train/logs               - è·å–è®­ç»ƒæ—¥å¿—
```

**æ¨¡å‹å¯¼å‡º**ï¼š
```python
# AI/app/blueprints/export.py
POST /export/onnx              - å¯¼å‡ºä¸ºONNXæ ¼å¼
POST /export/torchscript       - å¯¼å‡ºä¸ºTorchScript
GET  /export/list              - å¯¼å‡ºè®°å½•åˆ—è¡¨
```

**æ¨¡å‹éƒ¨ç½²**ï¼š
```python
# AI/app/blueprints/inference_task.py
POST /inference/start          - å¯åŠ¨æ¨ç†æœåŠ¡
POST /inference/stop           - åœæ­¢æ¨ç†æœåŠ¡
POST /inference/predict        - å•å¼ å›¾ç‰‡æ£€æµ‹
GET  /inference/list           - æ¨ç†ä»»åŠ¡åˆ—è¡¨
```

**LLMè§†è§‰åˆ†æ**ï¼š
```python
# AI/app/blueprints/llm.py
POST /llm/vision/analysis      - LLMè§†è§‰åˆ†æ
POST /llm/detection/object     - ç‰©ä½“æ£€æµ‹
GET  /llm/detection/supported/categories  - æ”¯æŒçš„æ£€æµ‹ç±»åˆ«

æ”¯æŒç±»åˆ«ï¼š
- äººå‘˜æ£€æµ‹ã€äººè„¸æ£€æµ‹
- è½¦è¾†æ£€æµ‹ã€è½¦ç‰Œè¯†åˆ«
- å®‰å…¨å¸½æ£€æµ‹ã€åå…‰è¡£æ£€æµ‹
- åŒºåŸŸå…¥ä¾µæ£€æµ‹
- ç«ç„°æ£€æµ‹ã€æ­¦å™¨æ£€æµ‹
```

**OCRè¯†åˆ«**ï¼š
```python
# AI/app/blueprints/ocr.py
POST /ocr/recognize            - OCRè¯†åˆ«
```

**âœ… å¯ä»¥å¤ç”¨çš„åŠŸèƒ½**ï¼š
- âœ… **æ¨¡å‹è®­ç»ƒ**ï¼šè®­ç»ƒå¥½çš„æ¨¡å‹ç»™TASKç”¨
- âœ… **æ¨¡å‹å¯¼å‡ºONNX**ï¼šTASKåŠ è½½onnxæ–‡ä»¶
- âœ… **å•å¼ å›¾ç‰‡æ£€æµ‹**ï¼šæµ‹è¯•æ¨¡å‹æ•ˆæœ
- âœ… **LLMè§†è§‰åˆ†æ**ï¼šå¯é€‰çš„é«˜çº§åŠŸèƒ½

**ğŸ”„ ä¸TASKçš„å…³ç³»**ï¼š
```
AIæ¨¡å—ï¼ˆç§‘å­¦å®¶ï¼‰            TASKæ¨¡å—ï¼ˆå·¥äººï¼‰
    â†“                          â†“
1. è®­ç»ƒYOLOv8            1. åŠ è½½onnxæ¨¡å‹
2. å¯¼å‡ºSafeHat.onnx  â†’  2. å®æ—¶æ¨ç†
3. æµ‹è¯•å•å¼ å›¾ç‰‡          3. å¤„ç†è§†é¢‘æµ
4. æ¨¡å‹ç®¡ç†              4. ç”Ÿäº§éƒ¨ç½²
```

---

### 5ï¸âƒ£ TASK æ¨¡å—ï¼ˆè¾¹ç¼˜AIæ¨ç† - C++ï¼‰

**å½“å‰çŠ¶æ€**: æ­£åœ¨å¼€å‘  
**æŠ€æœ¯æ ˆ**: C++17 + ONNX Runtime + OpenCV + FFmpeg + Glog  

#### å·²å®ŒæˆåŠŸèƒ½

```cpp
âœ… RTSPè§†é¢‘è§£ç ï¼ˆFFmpegï¼‰
âœ… YOLOv11æ¨ç†å¼•æ“ï¼ˆONNX Runtime CPUï¼‰
âœ… å¼‚æ­¥æ¨ç†ï¼ˆ4çº¿ç¨‹æ± ï¼‰
âœ… å®æ—¶ç”»æ¡†æ˜¾ç¤ºï¼ˆOpenCVçª—å£ï¼‰
âœ… å‘Šè­¦HTTPå›è°ƒï¼ˆcpp-httplibï¼‰
âœ… ç½®ä¿¡åº¦è¿‡æ»¤
âœ… å‘Šè­¦å†·å´æœºåˆ¶
âœ… RTSPè‡ªåŠ¨é‡è¿
âœ… é…ç½®æ–‡ä»¶è§£æï¼ˆINIæ ¼å¼ï¼‰
âœ… RTMPæ¨æµï¼ˆå·²å®ç°ï¼ŒHTTP-FLVæ’­æ”¾1ç§’å»¶è¿Ÿï¼‰
âœ… åŒºåŸŸé…ç½®è§£æï¼ˆConfigParseræ”¯æŒ[regions]æ®µï¼Œè§£æJSONå¤šè¾¹å½¢ï¼‰
```

#### éœ€è¦å¼€å‘çš„åŠŸèƒ½

```cpp
âŒ åŒºåŸŸè¿‡æ»¤é€»è¾‘ï¼ˆç‚¹åœ¨å¤šè¾¹å½¢å†…åˆ¤æ–­ - pointPolygonTestï¼‰
âŒ TaskManagerè¿›ç¨‹ç®¡ç†å™¨ï¼ˆHTTP APIï¼‰
âŒ é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨ï¼ˆJSONâ†’INIï¼‰
âŒ å¤šæ¨¡å‹åŠ¨æ€åŠ è½½
âŒ ç±»åˆ«æ–‡ä»¶åŠ è½½ï¼ˆä¸­æ–‡æ ‡ç­¾ï¼‰
âŒ èµ„æºé‡Šæ”¾å®Œå–„
```

#### åŒºåŸŸæ£€æµ‹ç°çŠ¶è¯´æ˜

**å·²æœ‰çš„**ï¼š
- âœ… `ConfigParser::parseRegion()` - è§£æJSONæ ¼å¼çš„å¤šè¾¹å½¢åæ ‡
- âœ… `Config::regions` - å­˜å‚¨å¤šä¸ªåŒºåŸŸçš„åæ ‡ç‚¹
- âœ… é…ç½®æ–‡ä»¶æ”¯æŒ `[regions]` æ®µ

**é…ç½®ç¤ºä¾‹**ï¼ˆtest.iniï¼‰ï¼š
```ini
[regions]
entrance=[[100,200],[300,200],[300,400],[100,400]]
parking=[[500,500],[800,500],[800,700],[500,700]]
```

**è¿˜ç¼ºçš„**ï¼š
- âŒ åœ¨ `Detech.cpp` ä¸­å®é™…ä½¿ç”¨è¿™äº›åŒºåŸŸè¿›è¡Œè¿‡æ»¤
- âŒ `cv::pointPolygonTest()` åˆ¤æ–­æ£€æµ‹æ¡†ä¸­å¿ƒæ˜¯å¦åœ¨åŒºåŸŸå†…
- âŒ åªæœ‰åœ¨åŒºåŸŸå†…çš„æ£€æµ‹æ‰è§¦å‘å‘Šè­¦

#### æ–‡ä»¶ç»“æ„

```
TASK/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Detech.cpp/h              # ä¸»ç¨‹åºï¼ˆè§†é¢‘å¤„ç†+AIæ¨ç†ï¼‰
â”‚   â”œâ”€â”€ Yolov11Engine.cpp/h       # YOLOæ¨ç†å¼•æ“
â”‚   â”œâ”€â”€ RTMPEncoder.cpp/h         # RTMPæ¨æµï¼ˆå·²å®Œæˆï¼‰
â”‚   â”œâ”€â”€ AlarmCallback.cpp/h       # å‘Šè­¦å›è°ƒ
â”‚   â”œâ”€â”€ ConfigParser.cpp/h        # é…ç½®è§£æ
â”‚   â”œâ”€â”€ Config.h                  # é…ç½®ç»“æ„ä½“
â”‚   â”œâ”€â”€ ThreadPoolExecutor.h      # çº¿ç¨‹æ± 
â”‚   â””â”€â”€ Utils.h                   # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/
â”‚   â””â”€â”€ test.ini                  # æµ‹è¯•é…ç½®
â”œâ”€â”€ models/
â”‚   â””â”€â”€ yolov11n.onnx            # YOLOæ¨¡å‹
â”œâ”€â”€ CMakeLists.txt               # ç¼–è¯‘é…ç½®
â””â”€â”€ build/Release/
    â””â”€â”€ TASK.exe                 # å¯æ‰§è¡Œæ–‡ä»¶
```

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```ini
# TASK/config/test.ini

[task]
task_id=1
task_name=entrance_monitor

[video]
source=rtsp://admin:Admin123@192.168.1.100:554/stream1
width=1920
height=1080
enable=true

[model]
model_path=models/SafeHat.onnx
confidence_threshold=0.5
nms_threshold=0.45
device=cpu

[rtmp]
enable=true
rtmp_url=rtmp://localhost:1935/live/camera_1
fps=25

[alarm]
enable=true
hook_url=http://localhost:48080/admin-api/device/alarm
confidence_threshold=0.6
cooldown_time=10

[features]
enable_rtmp=true
enable_draw=true
enable_alarm=true
```

---

## ğŸ¯ ç³»ç»Ÿæ•°æ®æµåˆ†æ

### å®Œæ•´ä¸šåŠ¡æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ1ï¼šæ¨¡å‹å‡†å¤‡ï¼ˆAIæ¨¡å—ï¼‰                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  è®­ç»ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¯¼å‡º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æ•°æ®æ ‡æ³¨  â”‚ â”€â”€â”€â”€> â”‚ YOLOv8   â”‚ â”€â”€â”€â”€> â”‚ SafeHat.onnxâ”‚        â”‚
â”‚  â”‚ï¼ˆWEB+VIDEOâ”‚       â”‚ è®­ç»ƒ     â”‚       â”‚ æ¨¡å‹æ–‡ä»¶     â”‚        â”‚
â”‚  â”‚  æˆªå›¾ï¼‰   â”‚       â”‚          â”‚       â”‚             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ2ï¼šä»»åŠ¡é…ç½®ï¼ˆWEBå‰ç«¯ï¼‰                                         â”‚
â”‚  ç”¨æˆ·æ“ä½œï¼š                                                        â”‚
â”‚  1. é€‰æ‹©æ‘„åƒå¤´ï¼ˆRTSPåœ°å€ï¼‰                                         â”‚
â”‚  2. é€‰æ‹©æ¨¡å‹ï¼ˆSafeHat.onnxï¼‰                                      â”‚
â”‚  3. é…ç½®æ£€æµ‹åŒºåŸŸï¼ˆå¤šè¾¹å½¢ROIï¼‰                                      â”‚
â”‚  4. é…ç½®å‘Šè­¦è§„åˆ™ï¼ˆé˜ˆå€¼ã€å†·å´æ—¶é—´ï¼‰                                  â”‚
â”‚  5. ç‚¹å‡»"å¯åŠ¨AIæ£€æµ‹"                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ3ï¼šä»»åŠ¡å¯åŠ¨ï¼ˆTaskManagerï¼‰                                    â”‚
â”‚  1. å‰ç«¯è°ƒç”¨ï¼šPOST /dev-api/task/config/generate                 â”‚
â”‚     â””â”€> TaskManagerç”Ÿæˆé…ç½®æ–‡ä»¶ï¼šconfig/task1.ini                â”‚
â”‚  2. å‰ç«¯è°ƒç”¨ï¼šPOST /dev-api/task/start                           â”‚
â”‚     â””â”€> TaskManagerå¯åŠ¨TASKå®ä¾‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ4ï¼šå®æ—¶æ¨ç†ï¼ˆTASKå®ä¾‹ï¼‰                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  è§£ç   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ¨ç†  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ RTSPæ‹‰æµ   â”‚ â”€â”€â”€â”€> â”‚ FFmpeg     â”‚ â”€â”€â”€â”€> â”‚ YOLO     â”‚       â”‚
â”‚  â”‚ 25fps     â”‚       â”‚ è§£ç        â”‚       â”‚ æ¨ç†     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                  â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ¨æµ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç”»æ¡†  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ZLMediaKitâ”‚ <â”€â”€â”€â”€â”€ â”‚ RTMPæ¨æµ   â”‚ <â”€â”€â”€â”€â”€ â”‚ OpenCV   â”‚       â”‚
â”‚  â”‚ HTTP-FLV  â”‚       â”‚ H.264      â”‚       â”‚ ç”»æ¡†     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        â†“                                         â†“              â”‚
â”‚   å‰ç«¯æ’­æ”¾                                   åŒºåŸŸè¿‡æ»¤            â”‚
â”‚   1ç§’å»¶è¿Ÿ                                       â†“              â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                            â”‚ å‘Šè­¦å›è°ƒ  â”‚         â”‚
â”‚                                            â”‚ HTTP POSTâ”‚         â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ5ï¼šå‘Šè­¦å¤„ç†ï¼ˆDEVICE + Node-REDï¼‰                              â”‚
â”‚  1. TASK â†’ POST /admin-api/device/alarm                         â”‚
â”‚     å‘Šè­¦æ•°æ®ï¼š{                                                   â”‚
â”‚       "task_id": 1,                                             â”‚
â”‚       "camera_id": "cam001",                                    â”‚
â”‚       "detections": [{class: "no_helmet", confidence: 0.85}],   â”‚
â”‚       "region_id": "entrance",                                  â”‚
â”‚       "timestamp": "2025-10-24 10:30:00"                        â”‚
â”‚     }                                                            â”‚
â”‚  2. DEVICEæ¥æ”¶ â†’ è§¦å‘Node-REDè§„åˆ™                                â”‚
â”‚  3. Node-REDå¤„ç†ï¼š                                               â”‚
â”‚     â”œâ”€> WebSocketæ¨é€å‰ç«¯ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰                             â”‚
â”‚     â”œâ”€> PostgreSQLå­˜å‚¨ï¼ˆå†å²è®°å½•ï¼‰                                â”‚
â”‚     â”œâ”€> ä¼ä¸šå¾®ä¿¡é€šçŸ¥ï¼ˆ@ç®¡ç†å‘˜ï¼‰                                   â”‚
â”‚     â”œâ”€> é’‰é’‰æœºå™¨äººï¼ˆç¾¤æ¶ˆæ¯ï¼‰                                      â”‚
â”‚     â””â”€> é‚®ä»¶/çŸ­ä¿¡ï¼ˆä¸¥é‡å‘Šè­¦ï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… å¼€å‘æ€è·¯ç¡®è®¤

### ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### 1. æ¨¡å—èŒè´£æ¸…æ™°

| æ¨¡å— | èŒè´£ | ä¸åšä»€ä¹ˆ |
|------|------|---------|
| **AIæ¨¡å—** | è®­ç»ƒæ¨¡å‹ã€å¯¼å‡ºæ¨¡å‹ã€æµ‹è¯•æ¨¡å‹ | âŒ ä¸åšå®æ—¶è§†é¢‘æµå¤„ç† |
| **VIDEOæ¨¡å—** | ONVIFç®¡ç†ã€PTZæ§åˆ¶ã€æˆªå›¾ | âŒ ä¸åšAIæ¨ç† |
| **TASKæ¨¡å—** | å®æ—¶AIæ¨ç†ã€è§†é¢‘æµå¤„ç† | âŒ ä¸åšæ¨¡å‹è®­ç»ƒ |
| **DEVICEæ¨¡å—** | ä¸šåŠ¡é€»è¾‘ã€å‘Šè­¦å¤„ç†ã€æƒé™ç®¡ç† | âŒ ä¸åšè§†é¢‘å¤„ç† |

#### 2. åŠŸèƒ½å¤ç”¨ç­–ç•¥

**âœ… ç›´æ¥å¤ç”¨**ï¼š
- DEVICEæ¨¡å—çš„å‘Šè­¦æ¥å£ï¼š`POST /device/alarm`
- VIDEOæ¨¡å—çš„ONVIFå‘ç°
- Node-REDè§„åˆ™å¼•æ“
- ç°æœ‰çš„ç”¨æˆ·æƒé™ä½“ç³»
- å‰ç«¯çš„æ‘„åƒå¤´ç®¡ç†é¡µé¢

**ğŸ”„ æ‰©å±•å¤ç”¨**ï¼š
- VIDEOçš„Deviceè¡¨ï¼šæ–°å¢`ai_task_id`ã€`ai_enabled`å­—æ®µ
- å‰ç«¯æ‘„åƒå¤´é¡µé¢ï¼šæ–°å¢"å¯åŠ¨AIæ£€æµ‹"æŒ‰é’®

**ğŸ†• å…¨æ–°å¼€å‘**ï¼š
- TaskManagerï¼ˆC++ HTTP APIï¼‰
- å‰ç«¯AIä»»åŠ¡ç®¡ç†é¡µé¢
- å‰ç«¯è§†é¢‘å¢™é¡µé¢

#### 3. æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·ç•Œé¢ï¼ˆWEBï¼‰
    â†“ é…ç½®è¯·æ±‚
TaskManager APIï¼ˆ7000ï¼‰
    â†“ å¯åŠ¨è¿›ç¨‹
TASKå®ä¾‹ï¼ˆC++å¤šè¿›ç¨‹ï¼‰
    â†“ RTMPæ¨æµ
ZLMediaKitï¼ˆ80ï¼‰
    â†“ HTTP-FLV
å‰ç«¯æ’­æ”¾å™¨ï¼ˆJessibucaï¼‰

å¹¶è¡Œæµç¨‹ï¼š
TASKå®ä¾‹
    â†“ HTTP POST
DEVICEå‘Šè­¦æ¥å£ï¼ˆ48080ï¼‰
    â†“ è§¦å‘è§„åˆ™
Node-REDï¼ˆ1880ï¼‰
    â†“ å¤šæ¸ é“é€šçŸ¥
ç”¨æˆ·ï¼ˆå¾®ä¿¡/é’‰é’‰/é‚®ä»¶ï¼‰
```

---

## ğŸ“‹ å¼€å‘è®¡åˆ’ç¡®è®¤

### é˜¶æ®µ1ï¼šTASKæ¨¡å—è¡¥å…¨ï¼ˆ3-4å¤©ï¼‰

**Day 1-2ï¼šå®Œå–„å·²æœ‰åŠŸèƒ½**
- [x] RTMPæ¨æµï¼ˆå·²å®Œæˆï¼‰
- [ ] åŒºåŸŸæ£€æµ‹ï¼ˆROIï¼‰
- [ ] èµ„æºé‡Šæ”¾å®Œå–„
- [ ] å¤šæ¨¡å‹æ”¯æŒ
- [ ] ç±»åˆ«æ–‡ä»¶åŠ è½½

**Day 3-4ï¼šæµ‹è¯•éªŒè¯**
- [ ] å•è·¯TASKç¨³å®šæ€§æµ‹è¯•
- [ ] å†…å­˜æ³„æ¼æ£€æµ‹
- [ ] å‘Šè­¦å›è°ƒæµ‹è¯•ï¼ˆå¯¹æ¥DEVICEï¼‰
- [ ] å»¶è¿Ÿæµ‹è¯•ï¼ˆ< 2ç§’ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
```bash
# 1. å¯åŠ¨TASK
.\TASK.exe ..\..\config\test.ini

# 2. éªŒè¯RTMPæ¨æµ
ffplay http://localhost/live/camera_1.flv

# 3. éªŒè¯å‘Šè­¦å›è°ƒ
curl http://localhost:48080/admin-api/device/alarm

# 4. éªŒè¯æ€§èƒ½
- FPS â‰¥ 20
- å»¶è¿Ÿ â‰¤ 2ç§’
- 24å°æ—¶è¿è¡Œå†…å­˜å¢é•¿ < 10%
```

---

### é˜¶æ®µ2ï¼šTaskManagerå¼€å‘ï¼ˆ2-3å¤©ï¼‰

**Day 5-6ï¼šHTTP APIå®ç°**

æ–°å»ºæ–‡ä»¶ï¼š`TASK/src/TaskManager.cpp`

```cpp
class TaskManager {
private:
    std::map<int, std::unique_ptr<Detech>> tasks;
    httplib::Server server;
    
public:
    // APIæ¥å£
    void startTask(int taskId, const std::string& configPath);
    void stopTask(int taskId);
    json getTaskStatus(int taskId);
    json getAllTasks();
    void generateConfig(const json& config);
    
    void run();  // å¯åŠ¨HTTPæœåŠ¡å™¨ï¼ˆç«¯å£7000ï¼‰
};
```

**APIè®¾è®¡**ï¼š
```
POST   /task/start           - å¯åŠ¨ä»»åŠ¡
POST   /task/stop            - åœæ­¢ä»»åŠ¡
GET    /task/status          - æŸ¥è¯¢çŠ¶æ€
GET    /task/list            - ä»»åŠ¡åˆ—è¡¨
POST   /config/generate      - ç”Ÿæˆé…ç½®
GET    /metrics              - æ€§èƒ½æŒ‡æ ‡
```

**Day 7ï¼šæµ‹è¯•éªŒè¯**
```bash
# å¯åŠ¨TaskManager
.\TaskManager.exe

# æµ‹è¯•API
curl -X POST http://localhost:7000/task/start \
  -H "Content-Type: application/json" \
  -d '{"task_id": 1, "config_path": "config/task1.ini"}'

curl http://localhost:7000/task/list
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½ç®¡ç†50ä¸ªTASKå®ä¾‹
- [ ] APIå“åº”æ—¶é—´ < 100ms
- [ ] å¯åŠ¨ä»»åŠ¡æˆåŠŸç‡ > 95%
- [ ] å†…å­˜å ç”¨åˆç†

---

### é˜¶æ®µ3ï¼šå‰ç«¯é›†æˆï¼ˆ2-3å¤©ï¼‰

**Day 8-9ï¼šAPIå¯¹æ¥**

**æ–°å»ºæ–‡ä»¶**ï¼š`WEB/src/api/task/index.ts`

```typescript
export const startTask = (taskId: number, configPath: string) => {
  return defHttp.post({
    url: '/dev-api/task/start',  // é€šè¿‡DEVICEç½‘å…³ä»£ç†
    data: { task_id: taskId, config_path: configPath }
  });
};

export const stopTask = (taskId: number) => {
  return defHttp.post({
    url: '/dev-api/task/stop',
    data: { task_id: taskId }
  });
};

export const getTaskStatus = (taskId: number) => {
  return defHttp.get({
    url: '/dev-api/task/status',
    params: { task_id: taskId }
  });
};

export const generateConfig = (config: TaskConfig) => {
  return defHttp.post({
    url: '/dev-api/task/config/generate',
    data: config
  });
};
```

**ä¿®æ”¹DEVICEç½‘å…³é…ç½®**ï¼š
```yaml
# DEVICE/iot-gateway/src/main/resources/application.yaml
spring.cloud.gateway.routes:
  - id: task-admin-api
    uri: http://localhost:7000  # TaskManager
    predicates:
      - Path=/admin-api/task/**
    filters:
      - StripPrefix=2
```

**ä¿®æ”¹å‰ç«¯ä»£ç†**ï¼š
```javascript
// WEB/.env.development
VITE_PROXY = [
  ["/api/v1/buckets", "http://localhost:9000/api/v1/buckets"],
  ["/dev-api/nodeRed", "http://127.0.0.1:1880"],
  ["/dev-api/task", "http://127.0.0.1:7000"],        // æ–°å¢
  ["/dev-api", "http://127.0.0.1:48080/admin-api"]
]
```

**Day 10ï¼šå‰ç«¯é¡µé¢**

**æ–¹æ¡ˆ1ï¼šæ‰©å±•ç°æœ‰æ‘„åƒå¤´é¡µé¢**
```vue
<!-- WEB/src/views/camera/index.vue -->
<template>
  <TableAction :actions="[
    {
      icon: 'octicon:play-16',
      tooltip: 'æ’­æ”¾è§†é¢‘',
      onClick: () => handlePlay(record)
    },
    {
      icon: 'ant-design:robot-outlined',
      tooltip: 'å¯åŠ¨AIæ£€æµ‹',
      onClick: () => handleStartAI(record)  // æ–°å¢
    },
    {
      icon: 'ant-design:stop-outlined',
      tooltip: 'åœæ­¢AIæ£€æµ‹',
      onClick: () => handleStopAI(record)   // æ–°å¢
    }
  ]" />
</template>
```

**æ–¹æ¡ˆ2ï¼šæ–°å»ºAIä»»åŠ¡é¡µé¢**ï¼ˆæ¨èï¼‰
```
æ–°å»ºé¡µé¢ï¼šWEB/src/views/ai-task/index.vue
è·¯ç”±ï¼š/ai-task
åŠŸèƒ½ï¼š
- AIä»»åŠ¡åˆ—è¡¨ï¼ˆ50è·¯ï¼‰
- æ–°å»º/ç¼–è¾‘/åˆ é™¤ä»»åŠ¡
- å¯åŠ¨/åœæ­¢ä»»åŠ¡
- å®æ—¶çŠ¶æ€ç›‘æ§
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å‰ç«¯èƒ½å¯åŠ¨/åœæ­¢AIä»»åŠ¡
- [ ] å‰ç«¯èƒ½æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
- [ ] å‰ç«¯èƒ½æ’­æ”¾AIæ£€æµ‹è§†é¢‘ï¼ˆå¸¦æ¡†ï¼‰
- [ ] æ“ä½œå“åº”æµç•…ï¼ˆ< 3ç§’ï¼‰

---

### é˜¶æ®µ4ï¼šè§†é¢‘å¢™+å‘Šè­¦ï¼ˆ1-2å¤©ï¼‰

**Day 11-12ï¼šè§†é¢‘å¢™é¡µé¢**

```vue
<!-- WEB/src/views/ai-task/video-wall.vue -->
<template>
  <div class="video-wall-grid grid-3x3">
    <div v-for="task in runningTasks" :key="task.task_id">
      <Jessibuca :playUrl="task.http_flv_url" />
      <div class="info-overlay">
        {{ task.camera_name }} | {{ task.fps }} FPS
      </div>
      <div v-if="task.has_alarm" class="alarm-indicator">
        å‘Šè­¦ä¸­
      </div>
    </div>
  </div>
</template>
```

**å¸ƒå±€æ”¯æŒ**ï¼š
- 2x2ï¼ˆ4è·¯ï¼‰
- 3x3ï¼ˆ9è·¯ï¼‰
- 4x4ï¼ˆ16è·¯ï¼‰
- 5x5ï¼ˆ25è·¯ï¼‰

**å‘Šè­¦é›†æˆ**ï¼š
```typescript
// WebSocketæ¥æ”¶å‘Šè­¦
const ws = new WebSocket('ws://localhost:48080/ws/alarm');
ws.onmessage = (event) => {
  const alarm = JSON.parse(event.data);
  // é«˜äº®å¯¹åº”è§†é¢‘çª—å£
  highlightCamera(alarm.camera_id);
  // æ˜¾ç¤ºå‘Šè­¦æç¤º
  showAlarmNotification(alarm);
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½åŒæ—¶æ’­æ”¾25è·¯è§†é¢‘
- [ ] å‘Šè­¦å®æ—¶æ˜¾ç¤ºï¼ˆ< 1ç§’ï¼‰
- [ ] å¸ƒå±€å¯åˆ‡æ¢
- [ ] æ€§èƒ½æµç•…ï¼ˆCPU < 50%ï¼‰

---

## ğŸ” æ½œåœ¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šDEVICEç½‘å…³å¦‚ä½•ä»£ç†TaskManagerï¼Ÿ

**é—®é¢˜**ï¼šSpring Cloud Gatewayé»˜è®¤åªæ”¯æŒNacosæœåŠ¡å‘ç°ï¼ŒTaskManageræ˜¯ç‹¬ç«‹C++æœåŠ¡ã€‚

**è§£å†³æ–¹æ¡ˆ1ï¼ˆæ¨èï¼‰**ï¼šç›´æ¥é…ç½®URI
```yaml
spring.cloud.gateway.routes:
  - id: task-admin-api
    uri: http://localhost:7000
    predicates:
      - Path=/admin-api/task/**
```

**è§£å†³æ–¹æ¡ˆ2**ï¼šTaskManageræ³¨å†Œåˆ°Nacos
```cpp
// ä¸æ¨èï¼Œå¢åŠ å¤æ‚åº¦
```

---

### é—®é¢˜2ï¼šVIDEOæ¨¡å—å’ŒTASKæ¨¡å—å¦‚ä½•åä½œï¼Ÿ

**å½“å‰çŠ¶æ€**ï¼š
- VIDEOï¼šFFmpegè¿›ç¨‹ç®¡ç†RTSPâ†’RTMP
- TASKï¼šå†…ç½®RTSPâ†’RTMP+AI

**é€‰æ‹©ç­–ç•¥**ï¼š

**ç­–ç•¥1ï¼šå®Œå…¨æ›¿ä»£**ï¼ˆæ¨èï¼‰
```
å‰ç«¯é€‰æ‹©ï¼š
- éœ€è¦AIæ£€æµ‹ â†’ å¯åŠ¨TASKï¼ˆä¸ç”¨VIDEOï¼‰
- ä¸éœ€è¦AI â†’ ä½¿ç”¨VIDEOè½¬å‘
```

**ç­–ç•¥2ï¼šååŒå·¥ä½œ**
```
VIDEOï¼šè´Ÿè´£RTSPæ‹‰æµã€ONVIFç®¡ç†
TASKï¼šè®¢é˜…VIDEOçš„æµï¼Œè¿›è¡ŒAIå¤„ç†
```

**å»ºè®®**ï¼šä½¿ç”¨ç­–ç•¥1ï¼Œç®€å•æ¸…æ™°ã€‚

---

### é—®é¢˜3ï¼š50è·¯å¹¶å‘æ€§èƒ½å¦‚ä½•ä¿è¯ï¼Ÿ

**ç¡¬ä»¶éœ€æ±‚**ï¼š
```
CPUï¼šIntel i7-12700ï¼ˆ12æ ¸24çº¿ç¨‹ï¼‰
å†…å­˜ï¼š32GB+
å­˜å‚¨ï¼š500GB SSD
ç½‘ç»œï¼šåƒå…†ç½‘ç»œ
```

**è½¯ä»¶ä¼˜åŒ–**ï¼š
```cpp
// 1. æ¯ä¸ªTASKå®ä¾‹ç‹¬ç«‹è¿›ç¨‹
TaskManagerå¯åŠ¨50ä¸ªTASKè¿›ç¨‹

// 2. èµ„æºé™åˆ¶
æ¯ä¸ªTASKï¼š
- CPUï¼š1-2æ ¸
- å†…å­˜ï¼š500MB
- çº¿ç¨‹æ± ï¼š4çº¿ç¨‹

// 3. RTMPæ¨æµä¼˜åŒ–
ç¼–ç å™¨ï¼šultrafast preset
ç ç‡ï¼š1-2Mbps
GOPï¼š10å¸§
```

**æ€§èƒ½é¢„ä¼°**ï¼š
```
å•è·¯TASKï¼š
- CPUï¼š~10%ï¼ˆå•æ ¸ï¼‰
- å†…å­˜ï¼š~500MB
- FPSï¼š25-30

50è·¯å¹¶å‘ï¼š
- CPUï¼š~80%ï¼ˆå…¨éƒ¨æ ¸å¿ƒï¼‰
- å†…å­˜ï¼š~25GB
- æ€»FPSï¼š1250-1500
```

**éªŒè¯æ–¹æ¡ˆ**ï¼š
```bash
# 1. å•è·¯æµ‹è¯•
å¯åŠ¨1ä¸ªTASKï¼Œç›‘æ§èµ„æºå ç”¨

# 2. 5è·¯æµ‹è¯•
å¯åŠ¨5ä¸ªTASKï¼Œç¡®è®¤çº¿æ€§æ‰©å±•

# 3. 10è·¯æµ‹è¯•
å¯åŠ¨10ä¸ªTASKï¼ŒéªŒè¯ç¨³å®šæ€§

# 4. 50è·¯æµ‹è¯•
å¯åŠ¨50ä¸ªTASKï¼Œå‹åŠ›æµ‹è¯•
```

---

## ğŸ‰ æ€»ç»“

### âœ… æ€è·¯ç¡®è®¤

**æ ¸å¿ƒè®¾è®¡æ€æƒ³**ï¼š
1. **èŒè´£åˆ†ç¦»**ï¼šAIæ¨¡å—è®­ç»ƒæ¨¡å‹ï¼ŒTASKæ¨¡å—ç”Ÿäº§æ¨ç†
2. **åŠŸèƒ½å¤ç”¨**ï¼šä½¿ç”¨ç°æœ‰çš„å‘Šè­¦æ¥å£ã€è§„åˆ™å¼•æ“ã€å‰ç«¯æ¡†æ¶
3. **æ¸è¿›å¼€å‘**ï¼šå…ˆå•è·¯â†’å†å¤šè·¯â†’æœ€åè§†é¢‘å¢™
4. **æ€§èƒ½ä¼˜å…ˆ**ï¼šC++å®ç°ï¼Œå¤šè¿›ç¨‹å¹¶å‘ï¼Œèµ„æºéš”ç¦»

**æŠ€æœ¯é€‰å‹æ­£ç¡®æ€§**ï¼š
- âœ… C++ï¼šé«˜æ€§èƒ½ï¼Œé€‚åˆå®æ—¶å¤„ç†
- âœ… ONNX Runtimeï¼šè·¨å¹³å°ï¼Œæ˜“é›†æˆ
- âœ… FFmpegï¼šæˆç†Ÿç¨³å®šï¼Œæ”¯æŒRTMP
- âœ… cpp-httplibï¼šè½»é‡HTTPæœåŠ¡å™¨
- âœ… ZLMediaKitï¼šé«˜æ€§èƒ½æµåª’ä½“

**åŠŸèƒ½å®Œæ•´æ€§**ï¼š
- âœ… å‰ç«¯æœ‰æ‘„åƒå¤´ç®¡ç†é¡µé¢ï¼ˆå¯æ‰©å±•ï¼‰
- âœ… åç«¯æœ‰å‘Šè­¦æ¥å£ï¼ˆå¯å¤ç”¨ï¼‰
- âœ… AIæ¨¡å—æœ‰æ¨¡å‹è®­ç»ƒï¼ˆå¯å¯¼å‡ºï¼‰
- âœ… VIDEOæœ‰ONVIFç®¡ç†ï¼ˆå¯ä¿ç•™ï¼‰
- âŒ ç¼ºTaskManagerï¼ˆå¾…å¼€å‘ï¼‰
- âŒ ç¼ºAIä»»åŠ¡é¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰

---

### ğŸ“‹ å¾…è¡¥å……æ–‡æ¡£

#### 1. å·²æœ‰æ–‡æ¡£
- âœ… `TASKæ¨¡å—å¼€å‘æŒ‡å¼•.md`ï¼ˆæŠ€æœ¯å®ç°ï¼‰
- âœ… `å¼€å‘è·¯çº¿å›¾-50è·¯æ‘„åƒå¤´ç®¡ç†.md`ï¼ˆè¯¦ç»†è®¡åˆ’ï¼‰
- âœ… `æ¶æ„åˆ†æä¸å¼€å‘è·¯çº¿å›¾.md`ï¼ˆç³»ç»Ÿåˆ†æï¼‰
- âœ… `ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æŒ‡å—.md`ï¼ˆHTTP-FLVéƒ¨ç½²ï¼‰

#### 2. éœ€è¦è¡¥å……çš„æ–‡æ¡£
- [ ] **TaskManager APIæ–‡æ¡£**ï¼šè¯¦ç»†çš„æ¥å£è¯´æ˜ã€è¯·æ±‚/å“åº”ç¤ºä¾‹
- [ ] **å‰ç«¯é›†æˆæ–‡æ¡£**ï¼šVueç»„ä»¶å¼€å‘æŒ‡å—ã€APIè°ƒç”¨ç¤ºä¾‹
- [ ] **éƒ¨ç½²æ–‡æ¡£**ï¼š50è·¯æ‘„åƒå¤´ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ­¥éª¤
- [ ] **æ•…éšœæ’æŸ¥æ–‡æ¡£**ï¼šå¸¸è§é—®é¢˜ã€æ—¥å¿—åˆ†æã€æ€§èƒ½è°ƒä¼˜
- [ ] **æµ‹è¯•æ–‡æ¡£**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å‹åŠ›æµ‹è¯•

#### 3. éœ€è¦åˆ›å»ºçš„é…ç½®ç¤ºä¾‹
- [ ] **å¤šä»»åŠ¡é…ç½®æ¨¡æ¿**ï¼štask1.ini ~ task50.iniç”Ÿæˆè„šæœ¬
- [ ] **å‘Šè­¦è§„åˆ™æ¨¡æ¿**ï¼šNode-REDè§„åˆ™ç¤ºä¾‹
- [ ] **ZLMediaKité…ç½®**ï¼šä½å»¶è¿Ÿä¼˜åŒ–é…ç½®
- [ ] **å‰ç«¯ç¯å¢ƒå˜é‡**ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®

---

### ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰**ï¼š
1. å®ŒæˆTASKæ¨¡å—çš„ROIåŒºåŸŸæ£€æµ‹ï¼ˆ1å¤©ï¼‰
2. å¼€å‘TaskManager HTTP APIï¼ˆ2å¤©ï¼‰
3. å‰ç«¯APIå¯¹æ¥ï¼ˆ1å¤©ï¼‰

**å¯ä»¥å»¶å**ï¼š
- å¤šæ¨¡å‹æ”¯æŒ
- ç±»åˆ«æ–‡ä»¶åŠ è½½
- æ€§èƒ½ç›‘æ§é¢æ¿
- GPUåŠ é€Ÿ

**ç¡®è®¤å¼€å§‹ï¼Ÿ** 
- [ ] ä»ROIåŒºåŸŸæ£€æµ‹å¼€å§‹
- [ ] ä»TaskManagerå¼€å‘å¼€å§‹
- [ ] ä»å‰ç«¯é›†æˆå¼€å§‹
- [ ] å…ˆåšå•è·¯å®Œæ•´æµç¨‹æµ‹è¯•

---

**å‡†å¤‡å¥½å¼€å§‹å®æ–½äº†å—ï¼Ÿéœ€è¦ä»å“ªä¸ªå¼€å§‹ï¼Ÿ** ğŸ¯


**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-24  
**ç›®çš„**: å…¨é¢æ¢³ç†ç³»ç»Ÿå„æ¨¡å—åŠŸèƒ½ï¼Œç¡®è®¤TASKæ¨¡å—å¼€å‘æ€è·¯ï¼Œé¿å…åŠŸèƒ½é‡å¤å’Œé—æ¼

---

## ğŸ“Š ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EasyAIoT äº‘è¾¹ç«¯ä¸€ä½“åŒ–å¹³å°                    â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   WEB    â”‚  â”‚  DEVICE  â”‚  â”‚   AI     â”‚  â”‚  VIDEO   â”‚         â”‚
â”‚  â”‚  å‰ç«¯UI  â”‚  â”‚  åç«¯ç½‘å…³ â”‚  â”‚ æ¨¡å‹è®­ç»ƒ  â”‚  â”‚ è§†é¢‘è½¬å‘  â”‚         â”‚
â”‚  â”‚  :8099   â”‚  â”‚  :48080  â”‚  â”‚  :5000   â”‚  â”‚  :6000   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â†“              â†“             â†“             â†“                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              åŸºç¡€è®¾æ–½å±‚                              â”‚          â”‚
â”‚  â”‚  PostgreSQL | MinIO | ZLMediaKit | Node-RED        â”‚          â”‚
â”‚  â”‚    :5432    | :9000 |   :1935    |  :1880          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              è¾¹ç¼˜è®¡ç®—å±‚ï¼ˆæ­£åœ¨å¼€å‘ï¼‰                   â”‚          â”‚
â”‚  â”‚  TASK(C++) + TaskManager(C++)                      â”‚          â”‚
â”‚  â”‚  å®æ—¶AIæ¨ç†   HTTP APIç®¡ç†å™¨                          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å„æ¨¡å—è¯¦ç»†åŠŸèƒ½æ¢³ç†

### 1ï¸âƒ£ WEB æ¨¡å—ï¼ˆå‰ç«¯ - Vue3ï¼‰

**ç«¯å£**: `8099`  
**æŠ€æœ¯æ ˆ**: Vue3 + TypeScript + Ant Design Vue + Vite  
**é…ç½®æ–‡ä»¶**: `WEB/.env`, `WEB/.env.development`

#### æ ¸å¿ƒé¡µé¢

| é¡µé¢è·¯å¾„ | åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|------|
| `/camera` | æ‘„åƒå¤´ç®¡ç† | âœ… å®Œæˆ | è®¾å¤‡åˆ—è¡¨ã€å¯åœè½¬å‘ã€è§†é¢‘æ’­æ”¾ |
| `/dataset` | æ•°æ®é›†ç®¡ç† | âœ… å®Œæˆ | æ•°æ®æ ‡æ³¨ã€å›¾ç‰‡/è§†é¢‘æ•°æ®é›† |
| `/train` | æ¨¡å‹è®­ç»ƒ | âœ… å®Œæˆ | YOLOv8è®­ç»ƒã€å¯¼å‡º |
| `/devices` | IoTè®¾å¤‡ç®¡ç† | âœ… å®Œæˆ | ç‰©è”ç½‘è®¾å¤‡ã€äº§å“ç®¡ç† |
| `/rulechains` | è§„åˆ™å¼•æ“ | âœ… å®Œæˆ | Node-REDè§„åˆ™é…ç½® |
| `/system` | ç³»ç»Ÿç®¡ç† | âœ… å®Œæˆ | ç”¨æˆ·ã€è§’è‰²ã€æƒé™ |
| `/dashboard` | ä»ªè¡¨ç›˜ | âœ… å®Œæˆ | æ•°æ®å¯è§†åŒ– |

#### æ‘„åƒå¤´ç®¡ç†é¡µé¢è¯¦ç»†åŠŸèƒ½

**æ–‡ä»¶**: `WEB/src/views/camera/index.vue`

**è¡¨æ ¼å±•ç¤º**ï¼š
```typescript
- è®¾å¤‡ID
- è®¾å¤‡åç§°
- åœ¨çº¿çŠ¶æ€ï¼ˆç»¿è‰²/çº¢è‰²ï¼‰
- åˆ¶é€ å•†ã€å‹å·ã€MACåœ°å€
- æ‹‰æµåœ°å€ï¼ˆRTSPï¼‰
- æ¨æµåœ°å€ï¼ˆRTMPï¼‰ â† VIDEOæ¨¡å—æ¨é€çš„
- æ’­æ”¾åœ°å€ï¼ˆHTTP-FLVï¼‰ â† å‰ç«¯æ’­æ”¾çš„
- æµçŠ¶æ€ï¼ˆrunning/stopped/errorï¼‰
- æ“ä½œæŒ‰é’®ï¼ˆæ’­æ”¾ã€å¯åœè½¬å‘ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
```

**APIè°ƒç”¨**ï¼š
```typescript
// WEB/src/api/device/camera.ts
startStreamForwarding(device_id)  // å¯åŠ¨VIDEOæ¨¡å—çš„RTSPè½¬å‘
stopStreamForwarding(device_id)   // åœæ­¢VIDEOæ¨¡å—çš„è½¬å‘
getStreamStatus(device_id)        // æŸ¥è¯¢è½¬å‘çŠ¶æ€
getDeviceList()                   // è·å–è®¾å¤‡åˆ—è¡¨
```

**è§†é¢‘æ’­æ”¾å™¨**ï¼š
```typescript
// WEB/src/components/VideoPlayer/DialogPlayer.vue
- Jessibucaæ’­æ”¾å™¨ï¼ˆæ”¯æŒHTTP-FLVï¼‰
- PTZäº‘å°æ§åˆ¶ï¼ˆä¸Šä¸‹å·¦å³ã€å˜ç„¦ï¼‰
- æ’­æ”¾åœ°å€åˆ‡æ¢
```

#### å‰ç«¯ä»£ç†é…ç½®

```javascript
// WEB/.env.development
VITE_PROXY = [
  ["/api/v1/buckets", "http://localhost:9000/api/v1/buckets"],  // MinIO
  ["/dev-api/nodeRed", "http://127.0.0.1:1880"],                // Node-RED
  ["/dev-api", "http://127.0.0.1:48080/admin-api"]              // DEVICEç½‘å…³
]
```

**âš ï¸ ç¼ºå¤±åŠŸèƒ½**ï¼š
- âŒ æ²¡æœ‰AIä»»åŠ¡ç®¡ç†é¡µé¢
- âŒ æ²¡æœ‰è§†é¢‘å¢™é¡µé¢
- âŒ æ²¡æœ‰TaskManageræ¥å£è°ƒç”¨

---

### 2ï¸âƒ£ DEVICE æ¨¡å—ï¼ˆåç«¯ç½‘å…³ - Java Springï¼‰

**ç«¯å£**: `48080`ï¼ˆSpring Cloud Gatewayï¼‰  
**æŠ€æœ¯æ ˆ**: Java 17 + Spring Boot + Spring Cloud Gateway + PostgreSQL  
**æ•°æ®åº“**: `iot_device10`

#### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**ğŸ“± IoTè®¾å¤‡ç®¡ç†**ï¼š
```java
// DEVICE/iot-device/iot-device-biz/src/main/java/com/basiclab/iot/device/controller/device/DeviceController.java

POST /device/report           - è®¾å¤‡ä¸ŠæŠ¥æ•°æ®
POST /device/alarm            - è®¾å¤‡å‘Šè­¦å›è°ƒ â† âš ï¸ TASKæ¨¡å—å‘Šè­¦å¯ä»¥ç”¨è¿™ä¸ªï¼
POST /device/isExist          - åˆ¤æ–­è®¾å¤‡æ˜¯å¦å­˜åœ¨
POST /device/webHook          - EMQXé’©å­å›è°ƒ
GET  /device/list             - è®¾å¤‡åˆ—è¡¨
PUT  /device/update           - æ›´æ–°è®¾å¤‡
DELETE /device/{id}           - åˆ é™¤è®¾å¤‡
```

**âš™ï¸ è§„åˆ™å¼•æ“ï¼ˆNode-REDé›†æˆï¼‰**ï¼š
```
ç«¯å£: 1880
åŠŸèƒ½:
- å‘Šè­¦è§„åˆ™é…ç½®
- æ•°æ®è½¬æ¢
- MQTT/KafkaèŠ‚ç‚¹
- è‡ªå®šä¹‰å‡½æ•°
- å¤–éƒ¨ç³»ç»Ÿé›†æˆï¼ˆä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€é‚®ä»¶ï¼‰
```

**ğŸ·ï¸ æ•°æ®æ ‡æ³¨**ï¼š
```
- æ•°æ®é›†ç®¡ç†
- å›¾ç‰‡/è§†é¢‘æ ‡æ³¨å·¥å…·
- æ ‡ç­¾ç®¡ç†
```

**ğŸ‘¥ ç³»ç»Ÿç®¡ç†**ï¼š
```
- ç§Ÿæˆ·ç®¡ç†
- ç”¨æˆ·ç®¡ç†
- è§’è‰²æƒé™
- èœå•ç®¡ç†
```

#### APIè·¯ç”±é…ç½®

```yaml
# DEVICE/iot-gateway/src/main/resources/application.yaml
spring.cloud.gateway.routes:
  - id: video-admin-api
    uri: lb://video-server
    predicates: Path=/admin-api/video/**
    
  - id: model-admin-api
    uri: lb://model-server
    predicates: Path=/admin-api/model/**
    
  - id: device-admin-api
    uri: lb://device-server
    predicates: Path=/admin-api/device/**
```

**âœ… å¯ä»¥å¤ç”¨çš„åŠŸèƒ½**ï¼š
- âœ… **å‘Šè­¦å›è°ƒæ¥å£**ï¼š`POST /device/alarm` - TASKæ¨¡å—å¯ä»¥ç›´æ¥ç”¨ï¼
- âœ… **è§„åˆ™å¼•æ“**ï¼šNode-REDå¤„ç†å‘Šè­¦é€»è¾‘
- âœ… **ç”¨æˆ·æƒé™**ï¼šå·²æœ‰çš„è®¤è¯é‰´æƒä½“ç³»

**âš ï¸ éœ€è¦æ–°å¢çš„**ï¼š
- âŒ TaskManagerä»£ç†è·¯ç”±ï¼ˆ`/admin-api/task/**` â†’ `http://localhost:7000`ï¼‰

---

### 3ï¸âƒ£ VIDEO æ¨¡å—ï¼ˆè§†é¢‘è½¬å‘ - Python Flaskï¼‰

**ç«¯å£**: `6000`  
**æŠ€æœ¯æ ˆ**: Python 3.8+ + Flask + FFmpeg + ONVIF  
**æ•°æ®åº“**: `iot_video10`

#### æ ¸å¿ƒåŠŸèƒ½

**APIæ¥å£**ï¼š
```python
# VIDEO/app/blueprints/camera.py

POST   /video/camera/device/{device_id}/stream/start   - å¯åŠ¨RTSPâ†’RTMPè½¬å‘
POST   /video/camera/device/{device_id}/stream/stop    - åœæ­¢è½¬å‘
GET    /video/camera/device/{device_id}/stream/status  - æŸ¥è¯¢è½¬å‘çŠ¶æ€
GET    /video/camera/list                              - æ‘„åƒå¤´åˆ—è¡¨
POST   /video/camera/register/device                   - æ³¨å†Œæ‘„åƒå¤´
PUT    /video/camera/device/{device_id}                - æ›´æ–°æ‘„åƒå¤´
DELETE /video/camera/device/{device_id}                - åˆ é™¤æ‘„åƒå¤´
POST   /video/camera/device/{device_id}/ptz            - PTZäº‘å°æ§åˆ¶
GET    /video/camera/discovery                         - ONVIFè®¾å¤‡å‘ç°
POST   /video/camera/refresh                           - åˆ·æ–°è®¾å¤‡åˆ—è¡¨

# æˆªå›¾åŠŸèƒ½
POST   /video/camera/device/{device_id}/rtsp/start     - å¯åŠ¨RTSPæˆªå›¾
POST   /video/camera/device/{device_id}/rtsp/stop      - åœæ­¢RTSPæˆªå›¾
GET    /video/camera/device/{device_id}/rtsp/status    - RTSPæˆªå›¾çŠ¶æ€
POST   /video/camera/device/{device_id}/onvif/start    - å¯åŠ¨ONVIFæˆªå›¾
POST   /video/camera/device/{device_id}/onvif/stop     - åœæ­¢ONVIFæˆªå›¾
GET    /video/camera/device/{device_id}/onvif/status   - ONVIFæˆªå›¾çŠ¶æ€
```

**FFmpegè½¬å‘å®ç°**ï¼š
```python
# VIDEO/app/blueprints/camera.py:37
class FFmpegDaemon:
    """FFmpegå®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†RTSPâ†’RTMPè½¬å‘"""
    
    def start(device_id, rtsp_url, rtmp_url):
        cmd = [
            'ffmpeg',
            '-rtsp_transport', 'tcp',
            '-i', rtsp_url,
            '-c', 'copy',
            '-f', 'flv',
            rtmp_url
        ]
        subprocess.Popen(cmd)
```

**æ•°æ®æ¨¡å‹**ï¼š
```python
# VIDEO/models.py
class Device(db.Model):
    id = db.Column(db.String(100), primary_key=True)
    name = db.Column(db.String(100))
    source = db.Column(db.Text)         # RTSPåœ°å€
    rtmp_stream = db.Column(db.Text)    # RTMPæ¨æµåœ°å€
    http_stream = db.Column(db.Text)    # HTTP-FLVæ’­æ”¾åœ°å€
    ip, port, username, password        # è®¾å¤‡è¿æ¥ä¿¡æ¯
    mac, manufacturer, model            # è®¾å¤‡ä¿¡æ¯
    support_move, support_zoom          # PTZèƒ½åŠ›
    enable_forward = db.Column(db.Boolean)  # æ˜¯å¦å¯ç”¨è½¬å‘
    nvr_id, nvr_channel                 # NVRä¿¡æ¯
```

**âœ… å¯ä»¥å¤ç”¨çš„åŠŸèƒ½**ï¼š
- âœ… **ONVIFè®¾å¤‡å‘ç°**ï¼šå¯ä»¥ç›´æ¥ç”¨äºå‘ç°æ‘„åƒå¤´
- âœ… **PTZäº‘å°æ§åˆ¶**ï¼šå¯ä»¥å¤ç”¨
- âœ… **æˆªå›¾æŠ“å¸§**ï¼šå¯ä»¥ç”¨äºæ•°æ®æ ‡æ³¨
- âœ… **æ•°æ®åº“è¡¨ç»“æ„**ï¼šDeviceè¡¨å¯ä»¥æ‰©å±•

**âŒ ä¸éœ€è¦çš„åŠŸèƒ½**ï¼ˆTASKä¼šæ›¿ä»£ï¼‰ï¼š
- âŒ RTSPâ†’RTMPè½¬å‘ï¼ˆTASKä¼šåšï¼Œä¸”å¸¦AIæ£€æµ‹ï¼‰
- âŒ FFmpegè¿›ç¨‹ç®¡ç†ï¼ˆTASKå†…ç½®ï¼‰

**ğŸ”„ æ”¹é€ æ–¹æ¡ˆ**ï¼š
- ä¿ç•™ONVIFã€PTZã€æˆªå›¾åŠŸèƒ½
- **æ–°å¢å­—æ®µ**ï¼š`ai_task_id`ã€`ai_enabled`ã€`ai_model`
- å‰ç«¯å¯ä»¥é€‰æ‹©ï¼šä½¿ç”¨VIDEOè½¬å‘ï¼ˆæ— AIï¼‰æˆ–å¯åŠ¨TASKï¼ˆæœ‰AIï¼‰

---

### 4ï¸âƒ£ AI æ¨¡å—ï¼ˆæ¨¡å‹è®­ç»ƒ - Python Flaskï¼‰

**ç«¯å£**: `5000`  
**æŠ€æœ¯æ ˆ**: Python 3.8+ + Flask + YOLOv8 + ONNX Runtime  
**æ•°æ®åº“**: `iot_ai10`

#### æ ¸å¿ƒåŠŸèƒ½

**æ¨¡å‹è®­ç»ƒ**ï¼š
```python
# AI/app/blueprints/train.py
POST /train/start              - å¯åŠ¨YOLOv8è®­ç»ƒ
POST /train/stop               - åœæ­¢è®­ç»ƒ
GET  /train/status             - æŸ¥è¯¢è®­ç»ƒçŠ¶æ€
GET  /train/logs               - è·å–è®­ç»ƒæ—¥å¿—
```

**æ¨¡å‹å¯¼å‡º**ï¼š
```python
# AI/app/blueprints/export.py
POST /export/onnx              - å¯¼å‡ºä¸ºONNXæ ¼å¼
POST /export/torchscript       - å¯¼å‡ºä¸ºTorchScript
GET  /export/list              - å¯¼å‡ºè®°å½•åˆ—è¡¨
```

**æ¨¡å‹éƒ¨ç½²**ï¼š
```python
# AI/app/blueprints/inference_task.py
POST /inference/start          - å¯åŠ¨æ¨ç†æœåŠ¡
POST /inference/stop           - åœæ­¢æ¨ç†æœåŠ¡
POST /inference/predict        - å•å¼ å›¾ç‰‡æ£€æµ‹
GET  /inference/list           - æ¨ç†ä»»åŠ¡åˆ—è¡¨
```

**LLMè§†è§‰åˆ†æ**ï¼š
```python
# AI/app/blueprints/llm.py
POST /llm/vision/analysis      - LLMè§†è§‰åˆ†æ
POST /llm/detection/object     - ç‰©ä½“æ£€æµ‹
GET  /llm/detection/supported/categories  - æ”¯æŒçš„æ£€æµ‹ç±»åˆ«

æ”¯æŒç±»åˆ«ï¼š
- äººå‘˜æ£€æµ‹ã€äººè„¸æ£€æµ‹
- è½¦è¾†æ£€æµ‹ã€è½¦ç‰Œè¯†åˆ«
- å®‰å…¨å¸½æ£€æµ‹ã€åå…‰è¡£æ£€æµ‹
- åŒºåŸŸå…¥ä¾µæ£€æµ‹
- ç«ç„°æ£€æµ‹ã€æ­¦å™¨æ£€æµ‹
```

**OCRè¯†åˆ«**ï¼š
```python
# AI/app/blueprints/ocr.py
POST /ocr/recognize            - OCRè¯†åˆ«
```

**âœ… å¯ä»¥å¤ç”¨çš„åŠŸèƒ½**ï¼š
- âœ… **æ¨¡å‹è®­ç»ƒ**ï¼šè®­ç»ƒå¥½çš„æ¨¡å‹ç»™TASKç”¨
- âœ… **æ¨¡å‹å¯¼å‡ºONNX**ï¼šTASKåŠ è½½onnxæ–‡ä»¶
- âœ… **å•å¼ å›¾ç‰‡æ£€æµ‹**ï¼šæµ‹è¯•æ¨¡å‹æ•ˆæœ
- âœ… **LLMè§†è§‰åˆ†æ**ï¼šå¯é€‰çš„é«˜çº§åŠŸèƒ½

**ğŸ”„ ä¸TASKçš„å…³ç³»**ï¼š
```
AIæ¨¡å—ï¼ˆç§‘å­¦å®¶ï¼‰            TASKæ¨¡å—ï¼ˆå·¥äººï¼‰
    â†“                          â†“
1. è®­ç»ƒYOLOv8            1. åŠ è½½onnxæ¨¡å‹
2. å¯¼å‡ºSafeHat.onnx  â†’  2. å®æ—¶æ¨ç†
3. æµ‹è¯•å•å¼ å›¾ç‰‡          3. å¤„ç†è§†é¢‘æµ
4. æ¨¡å‹ç®¡ç†              4. ç”Ÿäº§éƒ¨ç½²
```

---

### 5ï¸âƒ£ TASK æ¨¡å—ï¼ˆè¾¹ç¼˜AIæ¨ç† - C++ï¼‰

**å½“å‰çŠ¶æ€**: æ­£åœ¨å¼€å‘  
**æŠ€æœ¯æ ˆ**: C++17 + ONNX Runtime + OpenCV + FFmpeg + Glog  

#### å·²å®ŒæˆåŠŸèƒ½

```cpp
âœ… RTSPè§†é¢‘è§£ç ï¼ˆFFmpegï¼‰
âœ… YOLOv11æ¨ç†å¼•æ“ï¼ˆONNX Runtime CPUï¼‰
âœ… å¼‚æ­¥æ¨ç†ï¼ˆ4çº¿ç¨‹æ± ï¼‰
âœ… å®æ—¶ç”»æ¡†æ˜¾ç¤ºï¼ˆOpenCVçª—å£ï¼‰
âœ… å‘Šè­¦HTTPå›è°ƒï¼ˆcpp-httplibï¼‰
âœ… ç½®ä¿¡åº¦è¿‡æ»¤
âœ… å‘Šè­¦å†·å´æœºåˆ¶
âœ… RTSPè‡ªåŠ¨é‡è¿
âœ… é…ç½®æ–‡ä»¶è§£æï¼ˆINIæ ¼å¼ï¼‰
âœ… RTMPæ¨æµï¼ˆå·²å®ç°ï¼ŒHTTP-FLVæ’­æ”¾1ç§’å»¶è¿Ÿï¼‰
âœ… åŒºåŸŸé…ç½®è§£æï¼ˆConfigParseræ”¯æŒ[regions]æ®µï¼Œè§£æJSONå¤šè¾¹å½¢ï¼‰
```

#### éœ€è¦å¼€å‘çš„åŠŸèƒ½

```cpp
âŒ åŒºåŸŸè¿‡æ»¤é€»è¾‘ï¼ˆç‚¹åœ¨å¤šè¾¹å½¢å†…åˆ¤æ–­ - pointPolygonTestï¼‰
âŒ TaskManagerè¿›ç¨‹ç®¡ç†å™¨ï¼ˆHTTP APIï¼‰
âŒ é…ç½®æ–‡ä»¶ç”Ÿæˆå™¨ï¼ˆJSONâ†’INIï¼‰
âŒ å¤šæ¨¡å‹åŠ¨æ€åŠ è½½
âŒ ç±»åˆ«æ–‡ä»¶åŠ è½½ï¼ˆä¸­æ–‡æ ‡ç­¾ï¼‰
âŒ èµ„æºé‡Šæ”¾å®Œå–„
```

#### åŒºåŸŸæ£€æµ‹ç°çŠ¶è¯´æ˜

**å·²æœ‰çš„**ï¼š
- âœ… `ConfigParser::parseRegion()` - è§£æJSONæ ¼å¼çš„å¤šè¾¹å½¢åæ ‡
- âœ… `Config::regions` - å­˜å‚¨å¤šä¸ªåŒºåŸŸçš„åæ ‡ç‚¹
- âœ… é…ç½®æ–‡ä»¶æ”¯æŒ `[regions]` æ®µ

**é…ç½®ç¤ºä¾‹**ï¼ˆtest.iniï¼‰ï¼š
```ini
[regions]
entrance=[[100,200],[300,200],[300,400],[100,400]]
parking=[[500,500],[800,500],[800,700],[500,700]]
```

**è¿˜ç¼ºçš„**ï¼š
- âŒ åœ¨ `Detech.cpp` ä¸­å®é™…ä½¿ç”¨è¿™äº›åŒºåŸŸè¿›è¡Œè¿‡æ»¤
- âŒ `cv::pointPolygonTest()` åˆ¤æ–­æ£€æµ‹æ¡†ä¸­å¿ƒæ˜¯å¦åœ¨åŒºåŸŸå†…
- âŒ åªæœ‰åœ¨åŒºåŸŸå†…çš„æ£€æµ‹æ‰è§¦å‘å‘Šè­¦

#### æ–‡ä»¶ç»“æ„

```
TASK/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Detech.cpp/h              # ä¸»ç¨‹åºï¼ˆè§†é¢‘å¤„ç†+AIæ¨ç†ï¼‰
â”‚   â”œâ”€â”€ Yolov11Engine.cpp/h       # YOLOæ¨ç†å¼•æ“
â”‚   â”œâ”€â”€ RTMPEncoder.cpp/h         # RTMPæ¨æµï¼ˆå·²å®Œæˆï¼‰
â”‚   â”œâ”€â”€ AlarmCallback.cpp/h       # å‘Šè­¦å›è°ƒ
â”‚   â”œâ”€â”€ ConfigParser.cpp/h        # é…ç½®è§£æ
â”‚   â”œâ”€â”€ Config.h                  # é…ç½®ç»“æ„ä½“
â”‚   â”œâ”€â”€ ThreadPoolExecutor.h      # çº¿ç¨‹æ± 
â”‚   â””â”€â”€ Utils.h                   # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/
â”‚   â””â”€â”€ test.ini                  # æµ‹è¯•é…ç½®
â”œâ”€â”€ models/
â”‚   â””â”€â”€ yolov11n.onnx            # YOLOæ¨¡å‹
â”œâ”€â”€ CMakeLists.txt               # ç¼–è¯‘é…ç½®
â””â”€â”€ build/Release/
    â””â”€â”€ TASK.exe                 # å¯æ‰§è¡Œæ–‡ä»¶
```

#### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```ini
# TASK/config/test.ini

[task]
task_id=1
task_name=entrance_monitor

[video]
source=rtsp://admin:Admin123@192.168.1.100:554/stream1
width=1920
height=1080
enable=true

[model]
model_path=models/SafeHat.onnx
confidence_threshold=0.5
nms_threshold=0.45
device=cpu

[rtmp]
enable=true
rtmp_url=rtmp://localhost:1935/live/camera_1
fps=25

[alarm]
enable=true
hook_url=http://localhost:48080/admin-api/device/alarm
confidence_threshold=0.6
cooldown_time=10

[features]
enable_rtmp=true
enable_draw=true
enable_alarm=true
```

---

## ğŸ¯ ç³»ç»Ÿæ•°æ®æµåˆ†æ

### å®Œæ•´ä¸šåŠ¡æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ1ï¼šæ¨¡å‹å‡†å¤‡ï¼ˆAIæ¨¡å—ï¼‰                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  è®­ç»ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¯¼å‡º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æ•°æ®æ ‡æ³¨  â”‚ â”€â”€â”€â”€> â”‚ YOLOv8   â”‚ â”€â”€â”€â”€> â”‚ SafeHat.onnxâ”‚        â”‚
â”‚  â”‚ï¼ˆWEB+VIDEOâ”‚       â”‚ è®­ç»ƒ     â”‚       â”‚ æ¨¡å‹æ–‡ä»¶     â”‚        â”‚
â”‚  â”‚  æˆªå›¾ï¼‰   â”‚       â”‚          â”‚       â”‚             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ2ï¼šä»»åŠ¡é…ç½®ï¼ˆWEBå‰ç«¯ï¼‰                                         â”‚
â”‚  ç”¨æˆ·æ“ä½œï¼š                                                        â”‚
â”‚  1. é€‰æ‹©æ‘„åƒå¤´ï¼ˆRTSPåœ°å€ï¼‰                                         â”‚
â”‚  2. é€‰æ‹©æ¨¡å‹ï¼ˆSafeHat.onnxï¼‰                                      â”‚
â”‚  3. é…ç½®æ£€æµ‹åŒºåŸŸï¼ˆå¤šè¾¹å½¢ROIï¼‰                                      â”‚
â”‚  4. é…ç½®å‘Šè­¦è§„åˆ™ï¼ˆé˜ˆå€¼ã€å†·å´æ—¶é—´ï¼‰                                  â”‚
â”‚  5. ç‚¹å‡»"å¯åŠ¨AIæ£€æµ‹"                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ3ï¼šä»»åŠ¡å¯åŠ¨ï¼ˆTaskManagerï¼‰                                    â”‚
â”‚  1. å‰ç«¯è°ƒç”¨ï¼šPOST /dev-api/task/config/generate                 â”‚
â”‚     â””â”€> TaskManagerç”Ÿæˆé…ç½®æ–‡ä»¶ï¼šconfig/task1.ini                â”‚
â”‚  2. å‰ç«¯è°ƒç”¨ï¼šPOST /dev-api/task/start                           â”‚
â”‚     â””â”€> TaskManagerå¯åŠ¨TASKå®ä¾‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ4ï¼šå®æ—¶æ¨ç†ï¼ˆTASKå®ä¾‹ï¼‰                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  è§£ç   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ¨ç†  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ RTSPæ‹‰æµ   â”‚ â”€â”€â”€â”€> â”‚ FFmpeg     â”‚ â”€â”€â”€â”€> â”‚ YOLO     â”‚       â”‚
â”‚  â”‚ 25fps     â”‚       â”‚ è§£ç        â”‚       â”‚ æ¨ç†     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                  â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ¨æµ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç”»æ¡†  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ZLMediaKitâ”‚ <â”€â”€â”€â”€â”€ â”‚ RTMPæ¨æµ   â”‚ <â”€â”€â”€â”€â”€ â”‚ OpenCV   â”‚       â”‚
â”‚  â”‚ HTTP-FLV  â”‚       â”‚ H.264      â”‚       â”‚ ç”»æ¡†     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚        â†“                                         â†“              â”‚
â”‚   å‰ç«¯æ’­æ”¾                                   åŒºåŸŸè¿‡æ»¤            â”‚
â”‚   1ç§’å»¶è¿Ÿ                                       â†“              â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                            â”‚ å‘Šè­¦å›è°ƒ  â”‚         â”‚
â”‚                                            â”‚ HTTP POSTâ”‚         â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ5ï¼šå‘Šè­¦å¤„ç†ï¼ˆDEVICE + Node-REDï¼‰                              â”‚
â”‚  1. TASK â†’ POST /admin-api/device/alarm                         â”‚
â”‚     å‘Šè­¦æ•°æ®ï¼š{                                                   â”‚
â”‚       "task_id": 1,                                             â”‚
â”‚       "camera_id": "cam001",                                    â”‚
â”‚       "detections": [{class: "no_helmet", confidence: 0.85}],   â”‚
â”‚       "region_id": "entrance",                                  â”‚
â”‚       "timestamp": "2025-10-24 10:30:00"                        â”‚
â”‚     }                                                            â”‚
â”‚  2. DEVICEæ¥æ”¶ â†’ è§¦å‘Node-REDè§„åˆ™                                â”‚
â”‚  3. Node-REDå¤„ç†ï¼š                                               â”‚
â”‚     â”œâ”€> WebSocketæ¨é€å‰ç«¯ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰                             â”‚
â”‚     â”œâ”€> PostgreSQLå­˜å‚¨ï¼ˆå†å²è®°å½•ï¼‰                                â”‚
â”‚     â”œâ”€> ä¼ä¸šå¾®ä¿¡é€šçŸ¥ï¼ˆ@ç®¡ç†å‘˜ï¼‰                                   â”‚
â”‚     â”œâ”€> é’‰é’‰æœºå™¨äººï¼ˆç¾¤æ¶ˆæ¯ï¼‰                                      â”‚
â”‚     â””â”€> é‚®ä»¶/çŸ­ä¿¡ï¼ˆä¸¥é‡å‘Šè­¦ï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… å¼€å‘æ€è·¯ç¡®è®¤

### ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

#### 1. æ¨¡å—èŒè´£æ¸…æ™°

| æ¨¡å— | èŒè´£ | ä¸åšä»€ä¹ˆ |
|------|------|---------|
| **AIæ¨¡å—** | è®­ç»ƒæ¨¡å‹ã€å¯¼å‡ºæ¨¡å‹ã€æµ‹è¯•æ¨¡å‹ | âŒ ä¸åšå®æ—¶è§†é¢‘æµå¤„ç† |
| **VIDEOæ¨¡å—** | ONVIFç®¡ç†ã€PTZæ§åˆ¶ã€æˆªå›¾ | âŒ ä¸åšAIæ¨ç† |
| **TASKæ¨¡å—** | å®æ—¶AIæ¨ç†ã€è§†é¢‘æµå¤„ç† | âŒ ä¸åšæ¨¡å‹è®­ç»ƒ |
| **DEVICEæ¨¡å—** | ä¸šåŠ¡é€»è¾‘ã€å‘Šè­¦å¤„ç†ã€æƒé™ç®¡ç† | âŒ ä¸åšè§†é¢‘å¤„ç† |

#### 2. åŠŸèƒ½å¤ç”¨ç­–ç•¥

**âœ… ç›´æ¥å¤ç”¨**ï¼š
- DEVICEæ¨¡å—çš„å‘Šè­¦æ¥å£ï¼š`POST /device/alarm`
- VIDEOæ¨¡å—çš„ONVIFå‘ç°
- Node-REDè§„åˆ™å¼•æ“
- ç°æœ‰çš„ç”¨æˆ·æƒé™ä½“ç³»
- å‰ç«¯çš„æ‘„åƒå¤´ç®¡ç†é¡µé¢

**ğŸ”„ æ‰©å±•å¤ç”¨**ï¼š
- VIDEOçš„Deviceè¡¨ï¼šæ–°å¢`ai_task_id`ã€`ai_enabled`å­—æ®µ
- å‰ç«¯æ‘„åƒå¤´é¡µé¢ï¼šæ–°å¢"å¯åŠ¨AIæ£€æµ‹"æŒ‰é’®

**ğŸ†• å…¨æ–°å¼€å‘**ï¼š
- TaskManagerï¼ˆC++ HTTP APIï¼‰
- å‰ç«¯AIä»»åŠ¡ç®¡ç†é¡µé¢
- å‰ç«¯è§†é¢‘å¢™é¡µé¢

#### 3. æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·ç•Œé¢ï¼ˆWEBï¼‰
    â†“ é…ç½®è¯·æ±‚
TaskManager APIï¼ˆ7000ï¼‰
    â†“ å¯åŠ¨è¿›ç¨‹
TASKå®ä¾‹ï¼ˆC++å¤šè¿›ç¨‹ï¼‰
    â†“ RTMPæ¨æµ
ZLMediaKitï¼ˆ80ï¼‰
    â†“ HTTP-FLV
å‰ç«¯æ’­æ”¾å™¨ï¼ˆJessibucaï¼‰

å¹¶è¡Œæµç¨‹ï¼š
TASKå®ä¾‹
    â†“ HTTP POST
DEVICEå‘Šè­¦æ¥å£ï¼ˆ48080ï¼‰
    â†“ è§¦å‘è§„åˆ™
Node-REDï¼ˆ1880ï¼‰
    â†“ å¤šæ¸ é“é€šçŸ¥
ç”¨æˆ·ï¼ˆå¾®ä¿¡/é’‰é’‰/é‚®ä»¶ï¼‰
```

---

## ğŸ“‹ å¼€å‘è®¡åˆ’ç¡®è®¤

### é˜¶æ®µ1ï¼šTASKæ¨¡å—è¡¥å…¨ï¼ˆ3-4å¤©ï¼‰

**Day 1-2ï¼šå®Œå–„å·²æœ‰åŠŸèƒ½**
- [x] RTMPæ¨æµï¼ˆå·²å®Œæˆï¼‰
- [ ] åŒºåŸŸæ£€æµ‹ï¼ˆROIï¼‰
- [ ] èµ„æºé‡Šæ”¾å®Œå–„
- [ ] å¤šæ¨¡å‹æ”¯æŒ
- [ ] ç±»åˆ«æ–‡ä»¶åŠ è½½

**Day 3-4ï¼šæµ‹è¯•éªŒè¯**
- [ ] å•è·¯TASKç¨³å®šæ€§æµ‹è¯•
- [ ] å†…å­˜æ³„æ¼æ£€æµ‹
- [ ] å‘Šè­¦å›è°ƒæµ‹è¯•ï¼ˆå¯¹æ¥DEVICEï¼‰
- [ ] å»¶è¿Ÿæµ‹è¯•ï¼ˆ< 2ç§’ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
```bash
# 1. å¯åŠ¨TASK
.\TASK.exe ..\..\config\test.ini

# 2. éªŒè¯RTMPæ¨æµ
ffplay http://localhost/live/camera_1.flv

# 3. éªŒè¯å‘Šè­¦å›è°ƒ
curl http://localhost:48080/admin-api/device/alarm

# 4. éªŒè¯æ€§èƒ½
- FPS â‰¥ 20
- å»¶è¿Ÿ â‰¤ 2ç§’
- 24å°æ—¶è¿è¡Œå†…å­˜å¢é•¿ < 10%
```

---

### é˜¶æ®µ2ï¼šTaskManagerå¼€å‘ï¼ˆ2-3å¤©ï¼‰

**Day 5-6ï¼šHTTP APIå®ç°**

æ–°å»ºæ–‡ä»¶ï¼š`TASK/src/TaskManager.cpp`

```cpp
class TaskManager {
private:
    std::map<int, std::unique_ptr<Detech>> tasks;
    httplib::Server server;
    
public:
    // APIæ¥å£
    void startTask(int taskId, const std::string& configPath);
    void stopTask(int taskId);
    json getTaskStatus(int taskId);
    json getAllTasks();
    void generateConfig(const json& config);
    
    void run();  // å¯åŠ¨HTTPæœåŠ¡å™¨ï¼ˆç«¯å£7000ï¼‰
};
```

**APIè®¾è®¡**ï¼š
```
POST   /task/start           - å¯åŠ¨ä»»åŠ¡
POST   /task/stop            - åœæ­¢ä»»åŠ¡
GET    /task/status          - æŸ¥è¯¢çŠ¶æ€
GET    /task/list            - ä»»åŠ¡åˆ—è¡¨
POST   /config/generate      - ç”Ÿæˆé…ç½®
GET    /metrics              - æ€§èƒ½æŒ‡æ ‡
```

**Day 7ï¼šæµ‹è¯•éªŒè¯**
```bash
# å¯åŠ¨TaskManager
.\TaskManager.exe

# æµ‹è¯•API
curl -X POST http://localhost:7000/task/start \
  -H "Content-Type: application/json" \
  -d '{"task_id": 1, "config_path": "config/task1.ini"}'

curl http://localhost:7000/task/list
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½ç®¡ç†50ä¸ªTASKå®ä¾‹
- [ ] APIå“åº”æ—¶é—´ < 100ms
- [ ] å¯åŠ¨ä»»åŠ¡æˆåŠŸç‡ > 95%
- [ ] å†…å­˜å ç”¨åˆç†

---

### é˜¶æ®µ3ï¼šå‰ç«¯é›†æˆï¼ˆ2-3å¤©ï¼‰

**Day 8-9ï¼šAPIå¯¹æ¥**

**æ–°å»ºæ–‡ä»¶**ï¼š`WEB/src/api/task/index.ts`

```typescript
export const startTask = (taskId: number, configPath: string) => {
  return defHttp.post({
    url: '/dev-api/task/start',  // é€šè¿‡DEVICEç½‘å…³ä»£ç†
    data: { task_id: taskId, config_path: configPath }
  });
};

export const stopTask = (taskId: number) => {
  return defHttp.post({
    url: '/dev-api/task/stop',
    data: { task_id: taskId }
  });
};

export const getTaskStatus = (taskId: number) => {
  return defHttp.get({
    url: '/dev-api/task/status',
    params: { task_id: taskId }
  });
};

export const generateConfig = (config: TaskConfig) => {
  return defHttp.post({
    url: '/dev-api/task/config/generate',
    data: config
  });
};
```

**ä¿®æ”¹DEVICEç½‘å…³é…ç½®**ï¼š
```yaml
# DEVICE/iot-gateway/src/main/resources/application.yaml
spring.cloud.gateway.routes:
  - id: task-admin-api
    uri: http://localhost:7000  # TaskManager
    predicates:
      - Path=/admin-api/task/**
    filters:
      - StripPrefix=2
```

**ä¿®æ”¹å‰ç«¯ä»£ç†**ï¼š
```javascript
// WEB/.env.development
VITE_PROXY = [
  ["/api/v1/buckets", "http://localhost:9000/api/v1/buckets"],
  ["/dev-api/nodeRed", "http://127.0.0.1:1880"],
  ["/dev-api/task", "http://127.0.0.1:7000"],        // æ–°å¢
  ["/dev-api", "http://127.0.0.1:48080/admin-api"]
]
```

**Day 10ï¼šå‰ç«¯é¡µé¢**

**æ–¹æ¡ˆ1ï¼šæ‰©å±•ç°æœ‰æ‘„åƒå¤´é¡µé¢**
```vue
<!-- WEB/src/views/camera/index.vue -->
<template>
  <TableAction :actions="[
    {
      icon: 'octicon:play-16',
      tooltip: 'æ’­æ”¾è§†é¢‘',
      onClick: () => handlePlay(record)
    },
    {
      icon: 'ant-design:robot-outlined',
      tooltip: 'å¯åŠ¨AIæ£€æµ‹',
      onClick: () => handleStartAI(record)  // æ–°å¢
    },
    {
      icon: 'ant-design:stop-outlined',
      tooltip: 'åœæ­¢AIæ£€æµ‹',
      onClick: () => handleStopAI(record)   // æ–°å¢
    }
  ]" />
</template>
```

**æ–¹æ¡ˆ2ï¼šæ–°å»ºAIä»»åŠ¡é¡µé¢**ï¼ˆæ¨èï¼‰
```
æ–°å»ºé¡µé¢ï¼šWEB/src/views/ai-task/index.vue
è·¯ç”±ï¼š/ai-task
åŠŸèƒ½ï¼š
- AIä»»åŠ¡åˆ—è¡¨ï¼ˆ50è·¯ï¼‰
- æ–°å»º/ç¼–è¾‘/åˆ é™¤ä»»åŠ¡
- å¯åŠ¨/åœæ­¢ä»»åŠ¡
- å®æ—¶çŠ¶æ€ç›‘æ§
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å‰ç«¯èƒ½å¯åŠ¨/åœæ­¢AIä»»åŠ¡
- [ ] å‰ç«¯èƒ½æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
- [ ] å‰ç«¯èƒ½æ’­æ”¾AIæ£€æµ‹è§†é¢‘ï¼ˆå¸¦æ¡†ï¼‰
- [ ] æ“ä½œå“åº”æµç•…ï¼ˆ< 3ç§’ï¼‰

---

### é˜¶æ®µ4ï¼šè§†é¢‘å¢™+å‘Šè­¦ï¼ˆ1-2å¤©ï¼‰

**Day 11-12ï¼šè§†é¢‘å¢™é¡µé¢**

```vue
<!-- WEB/src/views/ai-task/video-wall.vue -->
<template>
  <div class="video-wall-grid grid-3x3">
    <div v-for="task in runningTasks" :key="task.task_id">
      <Jessibuca :playUrl="task.http_flv_url" />
      <div class="info-overlay">
        {{ task.camera_name }} | {{ task.fps }} FPS
      </div>
      <div v-if="task.has_alarm" class="alarm-indicator">
        å‘Šè­¦ä¸­
      </div>
    </div>
  </div>
</template>
```

**å¸ƒå±€æ”¯æŒ**ï¼š
- 2x2ï¼ˆ4è·¯ï¼‰
- 3x3ï¼ˆ9è·¯ï¼‰
- 4x4ï¼ˆ16è·¯ï¼‰
- 5x5ï¼ˆ25è·¯ï¼‰

**å‘Šè­¦é›†æˆ**ï¼š
```typescript
// WebSocketæ¥æ”¶å‘Šè­¦
const ws = new WebSocket('ws://localhost:48080/ws/alarm');
ws.onmessage = (event) => {
  const alarm = JSON.parse(event.data);
  // é«˜äº®å¯¹åº”è§†é¢‘çª—å£
  highlightCamera(alarm.camera_id);
  // æ˜¾ç¤ºå‘Šè­¦æç¤º
  showAlarmNotification(alarm);
};
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½åŒæ—¶æ’­æ”¾25è·¯è§†é¢‘
- [ ] å‘Šè­¦å®æ—¶æ˜¾ç¤ºï¼ˆ< 1ç§’ï¼‰
- [ ] å¸ƒå±€å¯åˆ‡æ¢
- [ ] æ€§èƒ½æµç•…ï¼ˆCPU < 50%ï¼‰

---

## ğŸ” æ½œåœ¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šDEVICEç½‘å…³å¦‚ä½•ä»£ç†TaskManagerï¼Ÿ

**é—®é¢˜**ï¼šSpring Cloud Gatewayé»˜è®¤åªæ”¯æŒNacosæœåŠ¡å‘ç°ï¼ŒTaskManageræ˜¯ç‹¬ç«‹C++æœåŠ¡ã€‚

**è§£å†³æ–¹æ¡ˆ1ï¼ˆæ¨èï¼‰**ï¼šç›´æ¥é…ç½®URI
```yaml
spring.cloud.gateway.routes:
  - id: task-admin-api
    uri: http://localhost:7000
    predicates:
      - Path=/admin-api/task/**
```

**è§£å†³æ–¹æ¡ˆ2**ï¼šTaskManageræ³¨å†Œåˆ°Nacos
```cpp
// ä¸æ¨èï¼Œå¢åŠ å¤æ‚åº¦
```

---

### é—®é¢˜2ï¼šVIDEOæ¨¡å—å’ŒTASKæ¨¡å—å¦‚ä½•åä½œï¼Ÿ

**å½“å‰çŠ¶æ€**ï¼š
- VIDEOï¼šFFmpegè¿›ç¨‹ç®¡ç†RTSPâ†’RTMP
- TASKï¼šå†…ç½®RTSPâ†’RTMP+AI

**é€‰æ‹©ç­–ç•¥**ï¼š

**ç­–ç•¥1ï¼šå®Œå…¨æ›¿ä»£**ï¼ˆæ¨èï¼‰
```
å‰ç«¯é€‰æ‹©ï¼š
- éœ€è¦AIæ£€æµ‹ â†’ å¯åŠ¨TASKï¼ˆä¸ç”¨VIDEOï¼‰
- ä¸éœ€è¦AI â†’ ä½¿ç”¨VIDEOè½¬å‘
```

**ç­–ç•¥2ï¼šååŒå·¥ä½œ**
```
VIDEOï¼šè´Ÿè´£RTSPæ‹‰æµã€ONVIFç®¡ç†
TASKï¼šè®¢é˜…VIDEOçš„æµï¼Œè¿›è¡ŒAIå¤„ç†
```

**å»ºè®®**ï¼šä½¿ç”¨ç­–ç•¥1ï¼Œç®€å•æ¸…æ™°ã€‚

---

### é—®é¢˜3ï¼š50è·¯å¹¶å‘æ€§èƒ½å¦‚ä½•ä¿è¯ï¼Ÿ

**ç¡¬ä»¶éœ€æ±‚**ï¼š
```
CPUï¼šIntel i7-12700ï¼ˆ12æ ¸24çº¿ç¨‹ï¼‰
å†…å­˜ï¼š32GB+
å­˜å‚¨ï¼š500GB SSD
ç½‘ç»œï¼šåƒå…†ç½‘ç»œ
```

**è½¯ä»¶ä¼˜åŒ–**ï¼š
```cpp
// 1. æ¯ä¸ªTASKå®ä¾‹ç‹¬ç«‹è¿›ç¨‹
TaskManagerå¯åŠ¨50ä¸ªTASKè¿›ç¨‹

// 2. èµ„æºé™åˆ¶
æ¯ä¸ªTASKï¼š
- CPUï¼š1-2æ ¸
- å†…å­˜ï¼š500MB
- çº¿ç¨‹æ± ï¼š4çº¿ç¨‹

// 3. RTMPæ¨æµä¼˜åŒ–
ç¼–ç å™¨ï¼šultrafast preset
ç ç‡ï¼š1-2Mbps
GOPï¼š10å¸§
```

**æ€§èƒ½é¢„ä¼°**ï¼š
```
å•è·¯TASKï¼š
- CPUï¼š~10%ï¼ˆå•æ ¸ï¼‰
- å†…å­˜ï¼š~500MB
- FPSï¼š25-30

50è·¯å¹¶å‘ï¼š
- CPUï¼š~80%ï¼ˆå…¨éƒ¨æ ¸å¿ƒï¼‰
- å†…å­˜ï¼š~25GB
- æ€»FPSï¼š1250-1500
```

**éªŒè¯æ–¹æ¡ˆ**ï¼š
```bash
# 1. å•è·¯æµ‹è¯•
å¯åŠ¨1ä¸ªTASKï¼Œç›‘æ§èµ„æºå ç”¨

# 2. 5è·¯æµ‹è¯•
å¯åŠ¨5ä¸ªTASKï¼Œç¡®è®¤çº¿æ€§æ‰©å±•

# 3. 10è·¯æµ‹è¯•
å¯åŠ¨10ä¸ªTASKï¼ŒéªŒè¯ç¨³å®šæ€§

# 4. 50è·¯æµ‹è¯•
å¯åŠ¨50ä¸ªTASKï¼Œå‹åŠ›æµ‹è¯•
```

---

## ğŸ‰ æ€»ç»“

### âœ… æ€è·¯ç¡®è®¤

**æ ¸å¿ƒè®¾è®¡æ€æƒ³**ï¼š
1. **èŒè´£åˆ†ç¦»**ï¼šAIæ¨¡å—è®­ç»ƒæ¨¡å‹ï¼ŒTASKæ¨¡å—ç”Ÿäº§æ¨ç†
2. **åŠŸèƒ½å¤ç”¨**ï¼šä½¿ç”¨ç°æœ‰çš„å‘Šè­¦æ¥å£ã€è§„åˆ™å¼•æ“ã€å‰ç«¯æ¡†æ¶
3. **æ¸è¿›å¼€å‘**ï¼šå…ˆå•è·¯â†’å†å¤šè·¯â†’æœ€åè§†é¢‘å¢™
4. **æ€§èƒ½ä¼˜å…ˆ**ï¼šC++å®ç°ï¼Œå¤šè¿›ç¨‹å¹¶å‘ï¼Œèµ„æºéš”ç¦»

**æŠ€æœ¯é€‰å‹æ­£ç¡®æ€§**ï¼š
- âœ… C++ï¼šé«˜æ€§èƒ½ï¼Œé€‚åˆå®æ—¶å¤„ç†
- âœ… ONNX Runtimeï¼šè·¨å¹³å°ï¼Œæ˜“é›†æˆ
- âœ… FFmpegï¼šæˆç†Ÿç¨³å®šï¼Œæ”¯æŒRTMP
- âœ… cpp-httplibï¼šè½»é‡HTTPæœåŠ¡å™¨
- âœ… ZLMediaKitï¼šé«˜æ€§èƒ½æµåª’ä½“

**åŠŸèƒ½å®Œæ•´æ€§**ï¼š
- âœ… å‰ç«¯æœ‰æ‘„åƒå¤´ç®¡ç†é¡µé¢ï¼ˆå¯æ‰©å±•ï¼‰
- âœ… åç«¯æœ‰å‘Šè­¦æ¥å£ï¼ˆå¯å¤ç”¨ï¼‰
- âœ… AIæ¨¡å—æœ‰æ¨¡å‹è®­ç»ƒï¼ˆå¯å¯¼å‡ºï¼‰
- âœ… VIDEOæœ‰ONVIFç®¡ç†ï¼ˆå¯ä¿ç•™ï¼‰
- âŒ ç¼ºTaskManagerï¼ˆå¾…å¼€å‘ï¼‰
- âŒ ç¼ºAIä»»åŠ¡é¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰

---

### ğŸ“‹ å¾…è¡¥å……æ–‡æ¡£

#### 1. å·²æœ‰æ–‡æ¡£
- âœ… `TASKæ¨¡å—å¼€å‘æŒ‡å¼•.md`ï¼ˆæŠ€æœ¯å®ç°ï¼‰
- âœ… `å¼€å‘è·¯çº¿å›¾-50è·¯æ‘„åƒå¤´ç®¡ç†.md`ï¼ˆè¯¦ç»†è®¡åˆ’ï¼‰
- âœ… `æ¶æ„åˆ†æä¸å¼€å‘è·¯çº¿å›¾.md`ï¼ˆç³»ç»Ÿåˆ†æï¼‰
- âœ… `ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æŒ‡å—.md`ï¼ˆHTTP-FLVéƒ¨ç½²ï¼‰

#### 2. éœ€è¦è¡¥å……çš„æ–‡æ¡£
- [ ] **TaskManager APIæ–‡æ¡£**ï¼šè¯¦ç»†çš„æ¥å£è¯´æ˜ã€è¯·æ±‚/å“åº”ç¤ºä¾‹
- [ ] **å‰ç«¯é›†æˆæ–‡æ¡£**ï¼šVueç»„ä»¶å¼€å‘æŒ‡å—ã€APIè°ƒç”¨ç¤ºä¾‹
- [ ] **éƒ¨ç½²æ–‡æ¡£**ï¼š50è·¯æ‘„åƒå¤´ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ­¥éª¤
- [ ] **æ•…éšœæ’æŸ¥æ–‡æ¡£**ï¼šå¸¸è§é—®é¢˜ã€æ—¥å¿—åˆ†æã€æ€§èƒ½è°ƒä¼˜
- [ ] **æµ‹è¯•æ–‡æ¡£**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å‹åŠ›æµ‹è¯•

#### 3. éœ€è¦åˆ›å»ºçš„é…ç½®ç¤ºä¾‹
- [ ] **å¤šä»»åŠ¡é…ç½®æ¨¡æ¿**ï¼štask1.ini ~ task50.iniç”Ÿæˆè„šæœ¬
- [ ] **å‘Šè­¦è§„åˆ™æ¨¡æ¿**ï¼šNode-REDè§„åˆ™ç¤ºä¾‹
- [ ] **ZLMediaKité…ç½®**ï¼šä½å»¶è¿Ÿä¼˜åŒ–é…ç½®
- [ ] **å‰ç«¯ç¯å¢ƒå˜é‡**ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®

---

### ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³å¼€å§‹ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰**ï¼š
1. å®ŒæˆTASKæ¨¡å—çš„ROIåŒºåŸŸæ£€æµ‹ï¼ˆ1å¤©ï¼‰
2. å¼€å‘TaskManager HTTP APIï¼ˆ2å¤©ï¼‰
3. å‰ç«¯APIå¯¹æ¥ï¼ˆ1å¤©ï¼‰

**å¯ä»¥å»¶å**ï¼š
- å¤šæ¨¡å‹æ”¯æŒ
- ç±»åˆ«æ–‡ä»¶åŠ è½½
- æ€§èƒ½ç›‘æ§é¢æ¿
- GPUåŠ é€Ÿ

**ç¡®è®¤å¼€å§‹ï¼Ÿ** 
- [ ] ä»ROIåŒºåŸŸæ£€æµ‹å¼€å§‹
- [ ] ä»TaskManagerå¼€å‘å¼€å§‹
- [ ] ä»å‰ç«¯é›†æˆå¼€å§‹
- [ ] å…ˆåšå•è·¯å®Œæ•´æµç¨‹æµ‹è¯•

---

**å‡†å¤‡å¥½å¼€å§‹å®æ–½äº†å—ï¼Ÿéœ€è¦ä»å“ªä¸ªå¼€å§‹ï¼Ÿ** ğŸ¯

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 